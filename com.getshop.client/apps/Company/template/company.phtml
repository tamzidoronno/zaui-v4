<?php
/* @var $this ns_a6d68820_a8e3_4eac_b2b6_b05043c28d78\Company */
$company = $this->getApi()->getUserManager()->getCompany($_POST['value']);
//print_r($company);
?>

<div class='gss_settings_header'>
    <i class='fa fa-edit'></i>

    <div class='gss_settings_header_description'>
        <div class='gss_settings_header_title'>
            <? echo $company->name; ?>
        </div>
        <div class='gss_settings_header_description_inner'>
            <?php
            echo $this->__f("Change company settings below");
            ?>
        </div>
    </div>
</div>

<div class='gss_settings_content'>

    <input type="hidden" gs_model='companymodel' gs_model_attr='companyid' value="<? echo $company->id; ?>"/>

    <div class="gss_settings_title"><? echo $this->__f("General company settings"); ?></div>
    <div class="textfield gss_setting"  id="vatNumber">
        <span class="title"><?php echo $this->__f("Vat number"); ?></span>
        <input type="textfield" gs_model='companymodel' gs_model_attr='vatNumber' value="<? echo $company->vatNumber; ?>">
        <div class="description">
            <?php echo $this->__w("The vat number"); ?>
        </div>
    </div>
    <div class="textfield gss_setting"  id="name">
        <span class="title"><?php echo $this->__f("Name"); ?></span>
        <input type="textfield" gs_model='companymodel' gs_model_attr='name' value="<? echo $company->name; ?>">
        <div class="description">
            <?php echo $this->__w("The company name"); ?>
        </div>
    </div>
    <div class="textfield gss_setting"  id="prefix">
        <span class="title"><?php echo $this->__f("Phone prefix"); ?></span>
        <input type="textfield" gs_model='companymodel' gs_model_attr='prefix' value="<? echo $company->prefix; ?>">
        <div class="description">
            <?php echo $this->__w("Country prefix for mobile phone"); ?>
        </div>
    </div>
    <div class="textfield gss_setting"  id="phone">
        <span class="title"><?php echo $this->__f("Phone"); ?></span>
        <input type="textfield" gs_model='companymodel' gs_model_attr='phone' value="<? echo $company->phone; ?>">
        <div class="description">
            <?php echo $this->__w("Phone number for company"); ?>
        </div>
    </div>
    <div class="textfield gss_setting"  id="email">
        <span class="title"><?php echo $this->__f("Email"); ?></span>
        <input type="textfield" gs_model='companymodel' gs_model_attr='email' value="<? echo $company->email; ?>">
        <div class="description">
            <?php echo $this->__w("Company's main email"); ?>
        </div>
    </div>
    <div class="textfield gss_setting"  id="invoiceEmail">
        <span class="title"><?php echo $this->__f("Invoice email"); ?></span>
        <input type="textfield" gs_model='companymodel' gs_model_attr='invoiceEmail' value="<? echo $company->invoiceEmail; ?>">
        <div class="description">
            <?php echo $this->__w("Company's invoice email"); ?>
        </div>
    </div>
    <div class="textfield gss_setting"  id="website">
        <span class="title"><?php echo $this->__f("Website"); ?></span>
        <input type="textfield" gs_model='companymodel' gs_model_attr='website' value="<? echo $company->website; ?>">
        <div class="description">
            <?php echo $this->__w("Company's website"); ?>
        </div>
    </div>
    <div class="textfield gss_setting"  id="contactPerson">
        <span class="title"><?php echo $this->__f("Contact"); ?></span>
        <input type="textfield" gs_model='companymodel' gs_model_attr='contactPerson' value="<? echo $company->contactPerson; ?>">
        <div class="description">
            <?php echo $this->__w("Default contact person for company"); ?>
        </div>
    </div>
    <div class="textfield gss_setting"  id="contactPerson">
        <span class="title"><?php echo $this->__f("Reference"); ?></span>
        <input type="textfield" gs_model='companymodel' gs_model_attr='reference' value="<? echo $company->reference; ?>">
        <div class="description">
            <?php echo $this->__w(""); ?>
        </div>
    </div>
    <div class="textfield gss_setting"  id="contactPerson">
        <span class="title"><?php echo $this->__f("Description"); ?></span>
        <textarea type="textfield" gs_model='companymodel' gs_model_attr='fritext'><? echo $company->fritext; ?></textarea>
        <div class="description">
            <?php echo $this->__w(""); ?>
        </div>
    </div>
    <br><br>
    <h2>Address</h2>
    <div class="textfield gss_setting"  id="address">
        <span class="title"><?php echo $this->__f("Address"); ?></span>
        <input type="textfield" gs_model='companymodel' gs_model_attr='address' value="<? echo @$company->address->address; ?>">
        <div class="description">
            <?php echo $this->__w("Company address"); ?>
        </div>
    </div>
    <div class="textfield gss_setting"  id="city">
        <span class="title"><?php echo $this->__f("Postcode"); ?></span>
        <input type="textfield" gs_model='companymodel' gs_model_attr='postCode' value="<? echo @$company->address->postCode; ?>">
        <div class="description">
            <?php echo $this->__w("Company postcode"); ?>
        </div>
    </div>
    <div class="textfield gss_setting"  id="postcode">
        <span class="title"><?php echo $this->__f("City"); ?></span>
        <input type="textfield" gs_model='companymodel' gs_model_attr='city' value="<? echo @$company->address->city; ?>">
        <div class="description">
            <?php echo $this->__w("Company city"); ?>
        </div>
    </div>
    <br><br>
    <h2>Invoice address</h2>
    <div class="textfield gss_setting"  id="invoice_address">
        <span class="title"><?php echo $this->__f("Address"); ?></span>
        <input type="textfield" gs_model='companymodel' gs_model_attr='invoice_address' value="<? echo @$company->invoiceAddress->address; ?>">
        <div class="description">
            <?php echo $this->__w("Company invoice address"); ?>
        </div>
    </div>
    <div class="textfield gss_setting"  id="city">
        <span class="title"><?php echo $this->__f("invoice_city"); ?></span>
        <input type="textfield" gs_model='companymodel' gs_model_attr='invoice_postCode' value="<? echo @$company->invoiceAddress->postCode; ?>">
        <div class="description">
            <?php echo $this->__w("Company invoice postcode"); ?>
        </div>
    </div>
    <div class="textfield gss_setting"  id="invoice_postcode">
        <span class="title"><?php echo $this->__f("City"); ?></span>
        <input type="textfield" gs_model='companymodel' gs_model_attr='invoice_city' value="<? echo @$company->invoiceAddress->city; ?>">
        <div class="description">
            <?php echo $this->__w("Company invoice city"); ?>
        </div>
    </div>
    
    <br><br>
    <h2>Group connection</h2>
    <div class="textfield gss_setting">
        <span class="title"><?php echo $this->__f("Connected to group"); ?></span>
        <?
            $groups = $this->getApi()->getUserManager()->getAllGroups();
            $companies = $this->getApi()->getUserManager()->getAllCompanies();
            echo "<select class='gsschangeusercompany backsideselect' gs_model_attr='groupId' gs_model='companymodel'>";
            echo "<option value=''>Unassigned</option>";
            foreach($groups as $group) {
                $sel = "";
                if($company->groupId == $group->id) {
                    $sel = "SELECTED";
                }
                echo "<option value='".$group->id."' $sel>" . $group->groupName . "</option>";
            }
            echo "</select>";

        ?>
        <div class="description">
            <?php echo $this->__("Is this user connected to a company?"); ?>
        </div>
    </div>
    <div class='gss_button_area'>
        <div class="gss_button" gss_method="deleteCompany" gss_confirmation="Are you sure you want to delete this company?" gss_model="companymodel"><i class="fa fa-remove"></i>Slett firma</div>
        <div class="gss_button" gss_method="updateCompanyInformation" gss_model="companymodel" gss_success_message="Saved successfully"><i class='fa fa-save'></i><?php echo $this->__("Update"); ?></div>
    </div>

</div>


<div class='gss_settings_content'>
    <center><h1><? echo $this->__f("Users connected to this company"); ?> </h1></center>
    <?
    $users = $this->getApi()->getUserManager()->getUsersByCompanyId($company->id);
    
    foreach ($users as $user) {
        ?>
    <div class='gss_company_userrow' onclick="app.Users.gssinterface.showUser('<? echo $user->id; ?>')">
        <?
        if ($user->isCompanyOwner) {
            echo "<i class='fa fa-building-o'></i>";
        }
        ?>
            <? echo $user->fullName; ?>
        </div>
        <?
    }
    ?>
</div>

<?
$apps = $this->getAppsWithPrintingToCompany();
foreach ($apps as $app) {
    $name = method_exists($app, "getBackendName") ? $app->getBackendName() : $app->getName();
    ?>
        <div class='gss_settings_content gss_settings_user_address'>
            <div class="gss_settings_title"><? echo $name; ?></div>
            <? $app->renderCompanySettings($company); ?>
        </div>
    <?
}
?>
