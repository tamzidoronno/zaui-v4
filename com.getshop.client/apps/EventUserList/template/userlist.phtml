<?
/* @var $this ns_bd751f7e_5062_4d0d_a212_b1fc6ead654f\EventUserList */
$event = $this->getEvent();
$users = $this->getApi()->getEventBookingManager()->getUsersForEvent($this->getBookingEngineName(), $event->id);
$groups = $this->getApi()->getUserManager()->getAllGroups();

if (!count($users)) {
    echo "<div style='padding: 20px;'>".$this->__w("No users added yet")."</div>";
    return;
}
?>

<div class='reports'>
    <center>Reports</center>
    <?
    foreach ($groups as $group) {
        echo "<div class='shop_button'> $group->groupName</div>&nbsp;";
    }
    ?>
</div>
<?
foreach ($users as $user) {
    $gradCapColor = "#006e63";
    $participatedStatus = @$event->participationStatus->{$user->id};
    $gradCapColor = $participatedStatus == "participated" ? "#006e63" : $gradCapColor;
    $gradCapColor = $participatedStatus == "participated_free" ? "#006e63" : $gradCapColor;
    $gradCapColor = $participatedStatus == "participated_50" ? "#d71e27" : $gradCapColor;
    $gradCapColor = $participatedStatus == "not_participated" ? "#d71e27" : $gradCapColor;
    
    $specialInfo = $this->getUserAdditionalInformation($user);
    
    ?>
    <div class="userline">
        <div class="gs_shop_small_icon" gsclick="removeUserFromEvent" gs_confirm="<? echo $this->__f("Are you sure you want to remove user from this event?"); ?>" eventid="<? echo $event->id; ?>"  userid="<? echo $user->id; ?>"><i class="fa fa-trash"></i></div>
        <? 
            $company = null;
            $group = null;
            
            if ($specialInfo) {
                ?>
                <div class="gs_shop_small_icon showspecialinfo">
                    <i class='fa fa-warning'></i>
                    <div class='user_special_comments'><? echo $specialInfo; ?></div>
                </div>
                <?
            }
            
            if ($user->groups) {
                $group = $this->getApi()->getUserManager()->getGroup($user->groups[0]);
            }
            
            if ($user->company) {
                $company = $this->getApi()->getUserManager()->getCompany($user->company[0]);    
            }
            
            $commentColor = array_key_exists($user->id, $event->comments) ? "style='color: green;'" : "";
            
            echo $user->fullName;
            if ($company) {
                echo " - ".$company->name;
            } else {
                echo " - N/A";
            }
            
            if ($group) {
                echo " - ".$group->groupName;
            } else {
                echo " - N/A";
            }
        ?>
        <div class="options">
            <div class="gs_shop_small_icon" gs_show_modal="uploadExternalCertificate" userid="<? echo $user->id; ?>" eventid="<? echo $event->id; ?>"><i class="fa fa-upload"></i></div>
            <div class="gs_shop_small_icon addcomment" userId="<? echo $user->id; ?>" eventId="<? echo $event->id; ?>"><i class="fa fa-comments" <? echo $commentColor; ?>></i></div>
            <div class="gs_shop_small_icon showsettings" userId="<? echo $user->id; ?>" eventId="<? echo $event->id; ?>"><i class="fa fa-gears"></i></div>
            <i class='fa fa-graduation-cap' style='color: <? echo $gradCapColor; ?>'></i>
        </div>
    </div>
    <?
}
?>

<br/>
<div style='padding-left: 20px;'>
    <div class='shop_button' gs_show_modal="send_reminder" eventid="<? echo $event->id; ?>">Send reminders</div>
    <div class='shop_button'>Download PDFs</div>
</div>