<?
/* @var $this \ns_f1706b4c_f779_4eb7_aec3_ee08f182e090\GetShopInbox */
$emails = $this->getEmails();
$admins = $this->getApi()->getUserManager()->getUsersByType(100);
?>

<div class='connectMailToCompany'>
    <?
    // Done like this as it might be case for speed improvement in future by loading
    // the companies as Ajax.
    $this->includefile("companies");
    ?>
</div>

<div class="row email header">
    <div class="col checkbox">
        <input type="checkbox" />
    </div>

    <div class="col date"><? echo $this->__f("Date"); ?></div>
    <div class="col subject"><? echo $this->__f("Subject"); ?></div>
    <div class="col from">
        <? 
        echo $this->__f("From");
        ?>
    </div>
    <div class="col company"><? echo $this->__f("Company"); ?></div>

    <div class="col icons">
        
    </div>
</div>

<div class='mailview'>
    <i class='fa fa-close closebox'></i>
    <div class='inner_mail_view'>
    </div>
</div>
<?

foreach ($emails as $email) {
    if ($email->inSent) {
        continue;
    }
    
    $attachment = strstr($email->contentType, "multipart/mixed") ? '<i class="fa fa-paperclip"></i>' : "";
    $replied = $email->inSent ? '<i class=" fa fa-reply"></i>' : ""; 
    $company = $email->connectedToCompanyId ? $email->connectedToCompanyName : "<i class='gs_shop_small_icon fa fa-link connecttocompany' msgid='$email->id' title='Connect to company'></i>"; 
    ?>
    <div class="row email showemail" msgid='<? echo $email->id; ?>'>
        <div class="col checkbox">
            <input type="checkbox" class='rowcheckbox' value="<? echo $email->id; ?>"/>
        </div>
        
        <div class="col date"><? echo date('d.m.Y H:i', strtotime($email->date)); ?></div>
        <div class="col subject"><? echo $email->subject; ?></div>
        <div class="col from">
            <? 
            $toPrint = str_replace(">", "", $email->from); 
            $toPrint = str_replace("<", "<br/>", $toPrint); 
            echo $toPrint;
            ?>
        </div>
        <div class="col company"><? echo $company; ?></div>
        
        <div class="col icons">
            <? echo $replied." ".$attachment; ?>
        </div>
        <div class='col buttons'>
            <div class='selected_checkbox_options'>
                <div class='fa fa-arrow-circle-o-down checkboxaction'></div>
                <div class='menu'>
                    <div class='entry'>Assign to:
                        <?
                        foreach ($admins as $admin) {
                        ?>
                            <div class='subentry doassignment' userid='<? echo $admin->id; ?>'><? echo $admin->fullName." - ".$admin->emailAddress." - ".$admin->cellPhone; ?></div>
                        <?
                        }
                        ?>
                    </div>
                    <div class='entry ignore'>Archive Message</div>
                </div>
            </div>
        </div>
    </div>
    <?
}
?>