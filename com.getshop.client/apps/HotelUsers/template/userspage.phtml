
<h1><i class='fa fa-bed'></i> Dine registrerte opphold</h1>
<hr>
<?
/* @var $api GetShopApi */
$api = $this->getApi();
$booking = $api->getHotelBookingManager()->getAllBookingsForUser();

if(!$booking) {
    echo "No booking reservations found for you.";
} else {
    echo "<table width='100%'>";
    echo "<thead>";
    echo "<tr>";
    echo "<td>Betalt</td>";
    echo "<td>Innsjekk</td>";
    echo "<td>Utsjekk</td>";
    echo "<td>Romtype</td>";
    echo "</tr>";
    echo "</thead>";
    
    foreach($booking as $bdata) {
        /* @var $bdata core_hotelbookingmanager_UsersBookingData */
        $productId = $bdata->additonalInformation->roomProductId;
        
        foreach($bdata->references as $reference) {
            /* @var $reference core_hotelbookingmanager_BookingReference */
            echo "<tr>";
            echo "<td>";
            if($bdata->payedFor) {
                echo "<i class='fa fa-check'>";
            } else {
                echo "<i class='fa fa-times'>";
            }
            echo "</td>";
            echo "<td>" . date("d-m-Y H:s", strtotime($reference->startDate)) . "</td><td>" . date("d-m-Y H:s", strtotime($reference->endDate)) . "</td>";
            echo "<td>" . sizeof($reference->roomsReserved) . " x " . $api->getProductManager()->getProduct($productId)->name . "<br>";
            foreach($reference->roomsReserved as $reserved) {
                foreach($reserved->visitors as $visitor) {
                    echo "&nbsp;&nbsp;&nbsp;<span style='color:#837f7a;'>" .  $visitor->name . ", tlf: " . $visitor->phone . ", epost: " . $visitor->email . "</span>";
                }
            }
            echo "</td>";
            echo "</tr>";
        }
    }
    echo "</table>";
}
?>
