<?
/* @var $this \ns_d16b27d9_579f_4d44_b90b_4223de0eb6f2\Hotelbooking */

$codes = [7840,93,355,213,1684,376,244,1264,1268,54,374,297,247,61,672,43,994,1242,973,880,1246,1268,375,32,501,229,1441,975,591,387,267,55,246,1284,673,359,226,257,855,237,1,238,345,236,235,56,86,61,61,57,269,242,243,682,506,385,53,599,537,420,45,246,253,1767,1809,670,56,593,20,503,240,291,372,251,500,298,679,358,33,596,594,689,241,220,995,49,233,350,30,299,1473,590,1671,502,224,245,595,509,504,852,36,354,91,62,98,964,353,972,39,225,1876,81,962,77,254,686,965,996,856,371,961,266,231,218,423,370,352,853,389,261,265,60,960,223,356,692,596,222,230,262,52,691,1808,373,377,976,382,1664,212,95,264,674,977,31,599,1869,687,64,505,227,234,683,672,850,1670,47,968,92,680,970,507,675,595,51,63,48,351,1787,974,262,40,7,250,685,378,966,221,381,248,232,65,421,386,677,27,500,82,34,94,249,597,268,46,41,963,886,992,255,66,670,228,690,676,1868,216,90,993,1649,688,1340,256,380,971,44,1,598,998,678,58,84,1808,681,967,260,255,263];
sort($codes);
?>
<div class='summary_heading'>
    <div class="spacer"></div>
    <h1>
        <? echo $this->__w("Visitor information"); ?>
    </h1>
    <div class="seperator"></div>
</div>
<?

$bookingDatas = $this->getManager()->getAllCurrentUserBookingData();
$rooms = $this->getHotelRooms();
foreach($bookingDatas as $bookingData) {
    /* @var $bookingData core_hotelbookingmanager_UsersBookingData */
    if(sizeof($bookingDatas) > 1) {
        echo "<h2>BesÃ¸kende for " . $this->getApi()->getProductManager()->getProduct($bookingData->additonalInformation->roomProductId)->name . "</h2>";
    }
    $reservedRooms = $bookingData->references[0]->roomsReserved;
    $i = 1;
    foreach($reservedRooms as $reservedRoom) {
        if ($this->getRoomCount() > 1) {
            $var = $this->__w("Contact person for room no. {count}");
            $var = str_replace("{count}", $i, $var);
            echo "<div class='visitor_heading'>$var</div>";
        }

        $roomId = $reservedRoom->roomId;
        $name = ""; $phone = ""; $email = "";
        $prefix = "";
        $visitor = new core_hotelbookingmanager_Visitors();
        if(isset($reservedRoom->visitors[0])) {
            $visitor = $reservedRoom->visitors[0];
            $name = $visitor->name;
            $phone = $visitor->phone;
            $email = $visitor->email;
            $prefix = $visitor->prefix;
        }

        ?>
        <div class='col-33'>
            <span class='contact_text'>* <? echo $this->__w("Full name"); ?></span>
            <span class='contact_input'><input type='text' gsname='room][<? echo $bookingData->id; ?>][<? echo $roomId; ?>][name]' value='<? echo $name ?>' class='<? echo $this->validateVisitor("name",$visitor); ?>' placeholder="Ola Norman">
            <? 
            if($this->validateVisitor("name",$visitor)) {
                echo "* " . $this->__w("Your name is not valid, it need to consist of first and last name.");
            }
            ?>
            </span>
        </div>
        <div class='col-33'>
            <span class='contact_text'>* <? echo $this->__w("Mobile phone"); ?></span>
            
            <table width='100%' cellspacing='0' cellpadding='0' class="phonevistiinfo">
                <tr>
                    <td>
                        <select class='phoneprefix' gsname='room][<? echo $bookingData->id; ?>][<? echo $roomId; ?>][prefix]'>
                        <?
                            foreach($codes as $drprefix) {
                                $selected =  "";
                                if($drprefix == "+47" && !$prefix) {
                                    $selected = " SELECTED";
                                }
                                if($drprefix == $prefix && $prefix) {
                                    $selected = " SELECTED";
                                }
                                echo "<option value='". $drprefix . "' $selected>+".$drprefix. "</option>";
                            }
                        ?>
                        </select>
                    </td>
                    <td>
                        <span class='contact_input'><input type='text' gsname='room][<? echo $bookingData->id; ?>][<? echo $roomId; ?>][phone]' value='<? echo $phone; ?>'  class='<? echo $this->validateVisitor("phone",$visitor); ?>' placeholder="4521887"></span>
                    </td>
                </tr>
            </table>
            <? echo $this->__w("The access code to the door will be sent to this phone number"); ?>
            <? 
            if($this->validateVisitor("phone",$visitor)) {
                echo "* " . $this->__w("Phone number need to be a valid mobile number.");
            }
            ?>
        </div>
        <div class='col-33'>
            <span class='contact_text'>* <? echo $this->__w("Email"); ?></span>
            <span class='contact_input'><input type='text' gsname='room][<? echo $bookingData->id; ?>][<? echo $roomId; ?>][email]' value='<? echo $email; ?>'  class='<? echo $this->validateVisitor("email",$visitor); ?>'  placeholder="din@epost.no"></span>
            <? 
            if($this->validateVisitor("email",$visitor)) {
                echo "* " . $this->__w("The email address is not valid.");
            }
            ?>
        </div>
        <div class="row_seperator"></div>
        <?
        $i++;
    }
}
?>
<br>
<div style="padding-left:10px;">
    * <? echo $this->__w("The following fields are required"); ?>
</div>
