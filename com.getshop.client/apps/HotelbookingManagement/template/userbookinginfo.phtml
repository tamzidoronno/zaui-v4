<?
/*Â @var $this ns_15e67fa1_c862_4bc3_9b17_dfd818f30712\HotelbookingManagement */
$id = $_POST['data']['bookingid'];
/* @var $bookingData core_hotelbookingmanager_UsersBookingData */
$bookingData = $this->getApi()->getHotelBookingManager()->getUserBookingData($id);
$product = $this->getApi()->getProductManager()->getProduct($bookingData->additonalInformation->roomProductId);
$rooms = $this->getApi()->getHotelBookingManager()->getAllRooms();
$allRooms = array();
foreach($rooms as $room) {
    $allRooms[$room->id] = $room;
}


echo "<div style='padding: 10px;'>";
if($bookingData->additonalInformation->isPartner) {
    echo "Price:<br> <input type='text' value='".round($bookingData->bookingPrice,2)."' class='bookingprice' bookingid='$id'>";
    echo "<input type='button' value='Update price' class='updatebookingprice'>";
    echo "<br><br>";
}
echo "<b>room type:</b> " . $product->name . "<br>";
echo "<br><b>Contract:</b> <a href='/scripts/whcontract.php?id=$id' class='gs_ignorenavigate' target='_new'>Open</a><br>";
if(!$bookingData->payedFor) {
    echo "<br><b>Payed for:</b> <span class='markaspayedfor' bdata-id='$id' style='cursor:pointer;'>Mark as payed for (for testing)</span><br>";
}
echo "<b>Booked by:</b> <a style='cursor:pointer;' onClick=\"thundashop.common.hideInformationBox();app.Users.gssinterface.showUser('".$bookingData->additonalInformation->userId."')\">open user</a><br>";
echo "<b>Payment links:</b>";
echo "&nbsp;&nbsp;&nbsp;&nbsp;";
foreach($bookingData->orderIds as $orderId) {
     echo "<a target='_new' href='http://".$_SERVER['SERVER_NAME'] . "?page=8d7776e2-2632-4ab9-bd01-86ac2d07899f&repayOrderId=$orderId"."'> open link</a>, ";
}
echo "<br>";
echo "<b>Orders:</b>";
echo "&nbsp;&nbsp;&nbsp;&nbsp;";
foreach($bookingData->orderIds as $orderId) {
     echo "<a style='cursor:pointer;' onClick=\"thundashop.common.hideInformationBox();app.OrderManager.gssinterface.showOrder('".$orderId."')\"> open order</a>, ";
}
echo "<bR>";
echo "<bR>";
echo "<bR>";
echo "<b>Booked dates</b><BR>";
foreach($bookingData->references as $reference) {
    echo "&nbsp;&nbsp;&nbsp;" . $reference->startDate . " - " . $reference->endDate."<BR>";
}
echo "</div>";
?>

Rooms :
<div style='padding: 20px;'>
<table>
<?
foreach($bookingData->references as $reference) {
    /* @var $reference core_hotelbookingmanager_BookingReference */
    foreach($reference->roomsReserved as $room) {
        /* @var $room core_hotelbookingmanager_RoomInformation */
        echo "<tr roomid='$room->roomId' bookinguserinfo='$bookingData->id' referenceid='$reference->bookingReference'>";
        echo "<td>";
        echo "<select class='roomSelected'>";
        foreach($allRooms as $roomId => $roomListEntry) {
            $selected = "";
            if($roomId == $room->roomId) {
                $selected = " SELECTED";
            }
            
            echo "<option value='$roomId' $selected>".$roomListEntry->roomName . "</option>";
        }
        echo "</select> <input type='button' value='Endre rom' class='changeroombutton'>";
        echo "</td></tr>";
        foreach($room->visitors as $visitor) {
            echo "<tr roomid='$room->roomId' bookinguserinfo='$bookingData->id' referenceid='$reference->bookingReference'>";
            echo "<td><input type='text' value='".$visitor->name."' name='name'></td>";
            echo "<td><input type='text' value='".$visitor->phone."' name='phone'></td>";
            echo "<td><input type='text' value='".$visitor->email."' name='email'><input type='button' value='Update' class='updatecontactinfo'></td>";
            echo "</tr>";
        }
    }
}
?>
</table>
</div>