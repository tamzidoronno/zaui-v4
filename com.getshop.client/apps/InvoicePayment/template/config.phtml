<?
/* @var $this ns_d02f8b7a_7395_455d_b754_888d7d701db8\Dibs */

$dibs = $this->getConfigurationSetting("merchantid");

$kidMethods = array();
$kidMethods[''] = "None";
$kidMethods['orderid'] = "Order id only";
$kidMethods['customeridandorderid'] = "Orderid + customerid";

$langauges = array();
$langauges['en_en'] = "English";
$langauges['nb_no'] = "Norsk";


$useSingleRoomTypes = array();
$useSingleRoomTypes['false'] = "No";
$useSingleRoomTypes['true'] = "Yes";


?>

<div class='gss_settings_header'>
    <i class='fa fa-envelope'></i>

    <div class='gss_settings_header_description'>
        <div class='gss_settings_header_title'>
            <?php echo $this->getName(); ?>
        </div>
        <div class='gss_settings_header_description_inner'>
            <?php echo $this->getDescription(); ?>
        </div>
    </div>	
</div>

<div class='gss_settings_content'>
    <div class="textfield gss_setting"  id="ordertype">
        <span class="title"><?php echo $this->__f("Account number"); ?></span>
        <input type="textfield" gs_model='invoicepaymentmodel' gs_model_attr='accountNumber' value="<? echo $this->getConfigurationSetting("accountNumber"); ?>">
        <div class="description">
            <?php  echo $this->__f("This is the accounting number that will be printed on the invoice, example XXXX XX XXXXX"); ?>
        </div>
    </div>
    <div class="textfield gss_setting"  id="ordertype">
        <span class="title"><?php echo $this->__f("Vat number"); ?></span>
        <input type="textfield" gs_model='invoicepaymentmodel' gs_model_attr='vatNumber' value="<? echo $this->getConfigurationSetting("vatNumber"); ?>">
        <div class="description">
            <?php  echo $this->__f("This is the vat number that will be printed on the invoice, example 123456789"); ?>
        </div>
    </div>
    <div class="textfield gss_setting"  id="ordertype">
        <span class="title"><?php echo $this->__f("Address"); ?></span>
        <input type="textfield" gs_model='invoicepaymentmodel' gs_model_attr='address' value="<? echo $this->getConfigurationSetting("address"); ?>">
        <div class="description">
            <?php  echo $this->__f("This is the address that will be printed on the invoice, example GetShop street 13"); ?>
        </div>
    </div>
    <div class="textfield gss_setting"  id="ordertype">
        <span class="title"><?php echo $this->__f("Company Name"); ?></span>
        <input type="textfield" gs_model='invoicepaymentmodel' gs_model_attr='companyName' value="<? echo $this->getConfigurationSetting("companyName"); ?>">
        <div class="description">
            <?php  echo $this->__f("This is the company name that will be printed on the invoice, example GetShop"); ?>
        </div>
    </div>
    <div class="textfield gss_setting"  id="ordertype">
        <span class="title"><?php echo $this->__f("Phone number"); ?></span>
        <input type="textfield" gs_model='invoicepaymentmodel' gs_model_attr='phoneNumber' value="<? echo $this->getConfigurationSetting("phoneNumber"); ?>">
        <div class="description">
            <?php  echo $this->__f("This is the company name that will be printed on the invoice, example GetShop"); ?>
        </div>
    </div>
    <div class="textfield gss_setting"  id="ordertype">
        <span class="title"><?php echo $this->__f("Post code"); ?></span>
        <input type="textfield" gs_model='invoicepaymentmodel' gs_model_attr='postCode' value="<? echo $this->getConfigurationSetting("postCode"); ?>">
        <div class="description">
            <?php  echo $this->__f("This is the post code that will be printed on the invoice, example 4380"); ?>
        </div>
    </div>
    <div class="textfield gss_setting"  id="city">
        <span class="title"><?php echo $this->__f("City"); ?></span>
        <input type="textfield" gs_model='invoicepaymentmodel' gs_model_attr='city' value="<? echo $this->getConfigurationSetting("city"); ?>">
        <div class="description">
            <?php  echo $this->__f("This is the city that will be printed on the invoice, example Las Vegas"); ?>
        </div>
    </div>
    <div class="textfield gss_setting"  id="city">
        <span class="title"><?php echo $this->__f("Contact email"); ?></span>
        <input type="textfield" gs_model='invoicepaymentmodel' gs_model_attr='contactEmail' value="<? echo $this->getConfigurationSetting("contactEmail"); ?>">
        <div class="description">
            <?php  echo $this->__f("This is the email address that will be printed on the invoice, example post@getshop.com"); ?>
        </div>
    </div>
    <div class="textfield gss_setting"  id="webAddress">
        <span class="title"><?php echo $this->__f("Web address"); ?></span>
        <input type="textfield" gs_model='invoicepaymentmodel' gs_model_attr='webAddress' value="<? echo $this->getConfigurationSetting("webAddress"); ?>">
        <div class="description">
            <?php  echo $this->__f("This is the web address that will be printed on the invoice, example http://www.getshop.com"); ?>
        </div>
    </div>
    <div class="textfield gss_setting"  id="webAddress">
        <span class="title"><?php echo $this->__f("Due days"); ?></span>
        <input type="textfield" gs_model='invoicepaymentmodel' gs_model_attr='duedays' value="<? echo $this->getConfigurationSetting("duedays"); ?>">
        <div class="description">
            <?php  echo $this->__f("Number of days the customer have to pay the invoice, example 14"); ?>
        </div>
    </div>

    <div class="gss_setting" id="defaultKidMethod">
        <div class="text inline title"><?php echo $this->__f("Please select the default kid method"); ?></div>

        <div class="gss_dropdown">
            <select class="config" gs_model='invoicepaymentmodel' gs_model_attr='defaultKidMethod'>
                <? foreach ($kidMethods as $key => $name) { 
                    $selected = $this->getConfigurationSetting("defaultKidMethod") == $key ? "SELECTED" : "";
                    ?>
                    <option value="<? echo $key; ?>" <?php echo $selected; ?>><? echo $name; ?></option>
                <? } ?>
            </select>
        </div>
        <div class="description">
            <?php echo $this->__("This will be the default kid solution."); ?>
        </div>        
    </div>

    <div class="textfield gss_setting"  id="kidSize">
        <span class="title"><?php echo $this->__f("Kid size"); ?></span>
        <input type='textfield' gs_model='invoicepaymentmodel' gs_model_attr='kidSize' value="<? echo $this->getConfigurationSetting("kidSize"); ?>" style='width: 50px;'>
        <div class="description">
            <?php echo $this->__("If cartCustomerId is set, use this payment application id as default"); ?>
        </div>
    </div>

    <div class="textfield gss_setting"  id="currency">
        <span class="title"><?php echo $this->__f("Currency"); ?></span>
        <input type='textfield' gs_model='invoicepaymentmodel' gs_model_attr='currency' value="<? echo $this->getConfigurationSetting("currency"); ?>" style='width: 50px;'>
        <div class="description">
            <?php echo $this->__("Currency text on invoice"); ?>
        </div>
    </div>
        
    <div class="gss_setting">
        <div class="text inline title"><?php echo $this->__f("Please select your invoice template type"); ?></div>

        <?
        $states = array();
        $states['type1'] = "type1";
        $states['type2'] = "type2";
        $states['php_template1'] = "Template1 (php)";
        $states['php_template2'] = "Template2 (php)";
        ?>
        
        <div class="gss_dropdown">
            <select class="config" gs_model='invoicepaymentmodel' gs_model_attr='type'>
                <? foreach ($states as $key => $lang) { 
                    $selected = $this->getConfigurationSetting("type") == $key ? "selected='true'" : "";
                    ?>
                    <option <? echo $selected; ?> value="<? echo $key; ?>"><? echo $lang; ?></option>
                <? } ?>
            </select>
        </div>    
    </div>
    
    <div class="textfield gss_setting"  id="iban">
        <span class="title"><?php echo $this->__f("IBAN"); ?></span>
        <input type="textfield" gs_model='invoicepaymentmodel' gs_model_attr='iban' value="<? echo $this->getConfigurationSetting("iban"); ?>">
        <div class="description">
            <?php  echo $this->__f("Iban number"); ?>
        </div>
    </div>
    
    <div class="textfield gss_setting"  id="swift">
        <span class="title"><?php echo $this->__f("SWIFT"); ?></span>
        <input type="textfield" gs_model='invoicepaymentmodel' gs_model_attr='swift' value="<? echo $this->getConfigurationSetting("swift"); ?>">
        <div class="description">
            <?php  echo $this->__f("Swift number"); ?>
        </div>
    </div>
    
    <div class="textfield gss_setting"  id="language">
        <span class="title"><?php echo $this->__f("Language"); ?></span>
        <div class="gss_dropdown">
            <select class="config" gs_model='invoicepaymentmodel' gs_model_attr='language'>
                <? foreach ($langauges as $key => $lang) { 
                    $selected = $this->getConfigurationSetting("language") == $key ? "selected='true'" : "";
                    ?>
                    <option <? echo $selected; ?> value="<? echo $key; ?>"><? echo $lang; ?></option>
                <? } ?>
            </select>
        </div>
        <div class="description">
            <?php  echo $this->__f("Selected language"); ?>
        </div>
    </div>
    
    <div class="textfield gss_setting"  id="useSingleRoomTypes">
        <span class="title"><?php echo $this->__f("Ignore room types on invoice, only print accomandation text"); ?></span>
        <div class="gss_dropdown">
            <select class="config" gs_model='invoicepaymentmodel' gs_model_attr='useSingleRoomTypes'>
                <? foreach ($useSingleRoomTypes as $key => $lang) { 
                    $selected = $this->getConfigurationSetting("useSingleRoomTypes") == $key ? "selected='true'" : "";
                    ?>
                    <option <? echo $selected; ?> value="<? echo $key; ?>"><? echo $lang; ?></option>
                <? } ?>
            </select>
        </div>
        <div class="description">
            <?php  echo $this->__f("Selected language"); ?>
        </div>
    </div>
    <div class="textfield"  id="language">
        <span class="title"><?php echo $this->__f("Logo"); ?></span>
        <div src="" height="200" alt="Image preview..." id="imageprivew" style='text-align: right;'>
            <?php
            $logo = $this->getConfigurationSetting("logo");
            if($logo) {
                echo "<img src='" . $logo . "' style='max-height: 200px; max-width: 200px;'></img>";
            }
            ?>
        </div>
        <input type='hidden' gs_model='invoicepaymentmodel' gs_model_attr='logo' id='logoinput'>
        <a onclick='$("#logoinput").val("");$("#imageprivew").html("");' style='color:blue; cursor:pointer;'>(clear logo)</a>
        <div class="description">
            <input type="file" onchange="previewFile()" id="uploadimagebutton" value='Upload a logo' style='position:relative; border:0px;'><br>
        </div>
    </div>
    
    
    <script>
       function previewFile(){
            if (!window.File || !window.FileReader || !window.FileList || !window.Blob) {
                alert('The File APIs are not fully supported in this browser.');
                return;
            }   
           
           var preview = $('#imageprivew'); //selects the query named img
           var file    = document.getElementById('uploadimagebutton').files[0]; //sames as here
           var reader  = new FileReader();
           reader.onloadend = function () {
               $('#logoinput').val(reader.result);
               preview.html("<img src='"+reader.result + "' style='max-width:200px; max-height: 200px;'>");
           }

           if (file) {
               reader.readAsDataURL(file); //reads the data as a URL
           } else {
               preview.src = "";
           }
      }
       previewFile();
    </script>
    
    <div class='gss_button_area'>
        <div class="gss_button" gss_method="saveSettings" gss_model="invoicepaymentmodel" gss_success_message="Saved successfully"><i class='fa fa-save'></i><?php echo $this->__("Save"); ?></div>
    </div>
    
    <? 
    $kidsize = $this->getConfigurationSetting("kidSize"); 
    if($kidsize && ((int)$kidsize) > 0) {
        $currentidSet = $this->getApi()->getStoreOcrManager()->getAccountingId();
        $currentidSet =$currentidSet ?  "Nets ocr id is : ". $currentidSet : "Account id not set yet";
    }
    ?>
</div>
