thundashop.Namespace.Register('thundashop.MainMenu');


var subtlepatterns = ['45degreee_fabric.png','debut_dark.png','linen.png','small-crackle-bright.png','60degree_gray.png','debut_light.png','littleknobs.png','small_tiles.png','absurdidad.png','denim.png','little_pluses.png','smooth_wall.png','agsquare.png','diagmonds.png','little_triangles.png','sneaker_mesh_fabric.png','always_grey.png','diagonales_decalees.png','low_contrast_linen.png','snow.png','arab_tile.png','diagonal-noise.png','lyonnette.png','soft_circle_scales.png','arches.png','diagonal_striped_brick.png','merely_cubed.png','soft_kill.png','argyle.png','diagonal_waves.png','micro_carbon.png','soft_pad.png','asfalt.png','diamonds.png','mirrored_squares.png','soft_wallpaper.png','assault.png','diamond_upholstery.png','mochaGrunge.png','solid.png','az_subtle.png','dimension.png','mooning.png','squairy_light.png','back_pattern.png','dirty_old_shirt.png','moulin.png','square_bg.png','batthern.png','double_lined.png','nami.png','squares.png','bedge_grunge.png','dust.png','nasty_fabric.png','stacked_circles.png','beige_paper.png','dvsup.png','natural_paper.png','starring.png','bgnoise_lg.png','ecailles.png','navy_blue.png','stitched_wool.png','billie_holiday.png','egg_shell.png','nistri.png','strange_bullseyes.png','binding_dark.png','elastoplast.png','noise_lines.png','straws.png','binding_light.png','elegant_grid.png','noise_pattern_with_crosslines.png','stressed_linen.png','black_denim.png','embossed_paper.png','noisy_grid.png','striped_lens.png','black-Linen.png','escheresque.png','noisy_net.png','struckaxiom.png','black_linen_v2.png','escheresque_ste.png','noisy.png','stucco.png','black_lozenge.png','exclusive_paper.png','norwegian_rose.png','subtle_carbon.png','black_mamba.png','extra_clean_paper.png','office.png','subtle_dots.png','blackmamba.png','fabric_1.png','old_mathematics.png','subtle_freckles.png','blackorchid.png','fabric_of_squares_gray.png','old_wall.png','subtle_grunge.png','black_paper.png','fabric_plaid.png','otis_redding.png','subtlenet2.png','black_scales.png','fake_brick.png','outlets.png','subtle_orange_emboss.png','black_thread.png','fake_luxury.png','p1.png','subtle_stripes.png','black_twill.png','fancy_deboss.png','p2.png','subtle_surface.png','blizzard.png','farmer.png','p4.png','subtle_white_feathers.png','blu_stripes.png','felt.png','p5.png','subtle_zebra_3d.png','bo_play_pattern.png','first_aid_kit.png','p6.png','swirl.png','brickwall.png','flowers.png','padded.png','tactile_noise.png','bright_squares.png','flowertrail.png','paper_1.png','tapestry_pattern.png','brillant.png','foggy_birds.png','paper_2.png','tasky_pattern.png','broken_noise.png','foil.png','paper_3.png','tex2res1.png','brushed_alu_dark.png','frenchstucco.png','paper_fibers.png','tex2res2.png','brushed_alu.png','furley_bg.png','paper.png','tex2res3.png','burried.png','geometry.png','paven.png','tex2res4.png','candyhole.png','gold_scale.png','perforated_white_leather.png','tex2res5.png','carbon_fibre_big.png','gplaypattern.png','pineapplecut.png','textured_paper.png','carbon_fibre.png','gradient_squares.png','pinstriped_suit.png','textured_stripes.png','carbon_fibre_v2.png','graphy.png','pinstripe.png','texturetastic_gray.png','cardboard_1.png','gray_jean.png','pixel_weave.png','ticks.png','cardboard_flat.png','gray_sand.png','plaid.png','tileable_wood_texture.png','cardboard.png','green_dust_scratch.png','polaroid.png','tiny_grid.png','cartographer.png','green-fibers.png','polonez_car.png','triangles_pattern.png','checkered_pattern.png','green_gobbler.png','polyester_lite.png','triangles.png','chruch.png','greyfloral.png','pool_table.png','triangular.png','circles.png','grey.png','project_papper.png','tweed.png','classy_fabric.png','grey_sandbag.png','ps_neutral.png','twinkle_twinkle.png','clean_textile.png','grey_wash_wall.png','psychedelic_pattern.png','txture.png','climpek.png','greyzz.png','purty_wood.png','type.png','cloth_alike.png','gridme.png','pw_maze_black.png','use_your_illusion.png','concrete_wall_2.png','grid_noise.png','pw_maze_white.png','vaio_hard_edge.png','concrete_wall_3.png','grid.png','pw_pattern.png','vertical_cloth.png','concrete_wall.png','grilled.png','px_by_Gre3g.png','vichy.png','connect.png','groovepaper.png','pyramid.png','vintage_speckles.png','cork_1.png','grunge_wall.png','quilt.png','wall4.png','corrugation.png','gun_metal.png','random_grey_variations.png','washi.png','cracks_1.png','handmadepaper.png','ravenna.png','wavecut.png','cream_dust.png','hexabump.png','real_cf.png','wavegrid.png','creampaper.png','hexellence.png','rebel.png','weave.png','cream_pixels.png','hixs_pattern_evolution.png','redox_01.png','white_bed_sheet.png','crisp_paper_ruffles.png','hoffman.png','redox_02.png','white_brick_wall.png','crissXcross.png','honey_im_subtle.png','reticular_tissue.png','white_carbonfiber.png','crossed_stripes.png','husk.png','retina_wood.png','white_carbon.png','crosses.png','ice_age.png','retro_intro.png','whitediamond.png','cross_scratches.png','inflicted.png','ricepaper2.png','white_leather.png','cubes.png','irongrip.png','ricepaper.png','white_paperboard.png','cutcube.png','kindajean.png','rip_jobs.png','white_plaster.png','daimond_eyes.png','knitted-netting.png','robots.png','white_sand.png','dark_brick_wall.png','knitting250px.png','rockywall.png','white_texture.png','dark_circles.png','kuji.png','roughcloth.png','white_tiles.png','darkdenim3.png','large_leather.png','rough_diagonal.png','white_wall2.png','dark_dotted2.png','leather_1.png','rubber_grip.png','white_wall_hash.png','dark_dotted.png','lghtmesh.png','satinweave.png','white_wall.png','dark_exa.png','light_alu.png','scribble_light.png','white_wave.png','dark_fish_skin.png','light_checkered_tiles.png','shattered.png','whitey.png','dark_geometric.png','light_grey_floral_motif.png','shinecaro.png','wide_rectangles.png','dark_leather.png','light_honeycomb.png','shinedotted.png','wild_oliva.png','dark_matter.png','light_noise_diagonal.png','shl.png','witewall_3.png','dark_mosaic.png','lightpaperfibers.png','silver_scales.png','wood_1.png','dark_stripes.png','light_toast.png','simple_dashed.png','wood_pattern.png','dark_Tire.png','light_wool.png','skelatal_weave.png','worn_dots.png','dark_wall.png','lil_fiber.png','skewed_print.png','woven.png','dark_wood.png','lined_paper.png','skin_side_up.png','xv.png','darth_stripe.png','linedpaper.png','slash_it.png','zigzag.png'];

thundashop.MainMenu = {
    hidden: false,
    selectedTarget: null,
    designSlideCount: 0,
    designMaxSlideCount: 0,
    displayApplicationInformation: function() {
        $('.app:not(.systemapplication)').each(function() {
            $(this).find('.mask').hide();
        });

        $('.app:not(.systemapplication)').each(function() {
            if ($(this).attr('appid')) {
                $(this).find('.appinfo_mask').addClass('delete');
                if ($(this).find('.appinfo_mask').css('display') == 'table') {
                    $(this).find('.appinfo_mask').css('display', 'none');
                    show = false;
                } else {
                    $(this).find('.appinfo_mask').css('display', 'table');
                }

                $(this).find('.appinfo_mask').width($(this).width() - 2);
                $(this).find('.appinfo_mask').height($(this).height());
            }
        });
    },
    showPageLayoutSelection: function() {
        var mode = 'edit';
        if($('.no_page_layout').length > 0) {
            mode = "new";
        }
        var event = thundashop.Ajax.createEvent("MainMenu", 'showPageLayoutSelection', $('body'), {"pagemode" : mode });
        thundashop.common.showInformationBox(event, __f("Select page layout"));
    },
    deleteApplicationClicked: function() {
        $('.app:not(.systemapplication)').each(function() {
            $(this).find('.order_mask').hide();
        });

        $('.app:not(.systemapplication)').each(function() {
            if ($(this).attr('appid')) {
                $(this).find('.mask').addClass('delete');
                if ($(this).find('.mask').css('display') == 'table') {
                    $(this).find('.mask').css('display', 'none');
                } else {
                    $(this).find('.mask').css('display', 'table');
                }

                $(this).find('.mask').width($(this).width() - 2);
                $(this).find('.mask').height($(this).height());
            }
        });
    },
    setDesignVariation: function() {
        $('body').css('background-color', '');
        if ($(this).attr('image')) {
            var data = {"bg": $(this).attr('image')}
        } else {
            var data = {"color": $(this).attr('color')}
        }

        var event = thundashop.Ajax.createEvent('', 'setDesignVariation', null, data);
        thundashop.Ajax.post(event, function() {
            var random = Math.random();
            $('body').css('background-image', '');
            document.getElementById('mainlessstyle').href = 'StyleSheet.php?rand=' + random;

            var event = thundashop.Ajax.createEvent("", "loadColorAttributes", $(this), {});
            thundashop.Ajax.postWithCallBack(event, function(data) {
                $('body').find('#set_colors').remove();
                $('body').append(data);
            });

        }, null, true);
    },
    selectDesign: function() {
        var selectionbox = $('.designselectionbox');
        selectionbox.find('.selecteddesign').removeClass('selecteddesign');
        $(this).addClass('selecteddesign');
        $('body').find('#set_colors').remove();
        var appSettingsId = $(this).attr('id');
        data = {
            appId: appSettingsId
        }

        selectionbox.find('.advanced_colors').hide();
        selectionbox.find('.advanced_colors[panel="' + appSettingsId + '"]').show();

        var callback = function() {
            var random = Math.random();
            document.getElementById('mainlessstyle').href = 'StyleSheet.php?rand=' + random;
            thundashop.common.unlockMask();
            thundashop.common.hideInformationBox(null);
            thundashop.framework.reprintPage();
        }
        var event = thundashop.Ajax.createEvent('ApplicationManager', 'addApplicationDirect', $(document), data);
        $('.designattributes_color').hide();
        $('.designattributes_color[panel="' + appSettingsId + '"]').show();

        if ($(this).attr('hasbg') === "1") {
            $('.colorselection .background').show();
            $('.colorselection .nobackground').hide();
        } else {
            $('.colorselection .background').hide();
            $('.colorselection .nobackground').show();
        }
        thundashop.Ajax.postWithCallBack(event, callback);
    },
    showAddApplication: function() {

        $('html').find('.add_application_menu').each(function() {
            if ($(this).is(':visible')) {
                if ($(this).attr('shown') == 'true') {
                    $(this).hide();
                    $(this).attr('shown', null);
                }
            } else {
                $(this).css('display', 'block');
                $(this).attr('shown', 'true');
            }
        });
    },
    marginGearClicked: function() {
        var row = $(this).closest('.gs_row');
        $(this).off('click');
        $(this).addClass('expanded');
        $(this).removeClass('fa-adjust');
        $(this).animate({height: "275px", width: "100px"}, function() {
            $(this).css('padding', '10px');

            row.prepend('<div class="gs_row_seperator">');
            row.append('<div class="gs_row_seperator">');
            row.before('<div class="gs_row_seperator">');
            row.after('<div class="gs_row_seperator">');

            var close = $('<span style="position:absolute; right: 2px; bottom: 0px;">' + __f('Close') + '</span>');
            close.on('click', function() {
                var area = $(this).closest('.gs_margin_operations');
                area.find('.gs_margin_inner').fadeOut(function() {
                    area.removeClass('expanded');
                    area.css('padding', '');
                    area.animate({height: "28px", width: "26px"}, function() {
                        area.addClass('fa-adjust');
                        area.on('click', thundashop.MainMenu.marginGearClicked)
                    });
                });
                row.find('.gs_row_seperator').remove();
                row.prev('.gs_row_seperator').remove();
                row.next('.gs_row_seperator').remove();
            });

            var save = $("<span style='position:absolute;left:0px; bottom:0px;'>" + __f("Save") + "</span>");
            save.on('click', function() {
                var data = {
                    "gs_outer": row.attr('style'),
                    "gs_inner": row.find('.gs_inner').attr('style'),
                    "row" : row.attr('row')
                }
                var event = thundashop.Ajax.createEvent('','saveStyling','',data);
                thundashop.Ajax.postWithCallBack(event, function() {
                    close.click();
                });
            });
            
            var select = $('<select></select>');
            select.append('<option value=";margin-top;">margin-top</option>');
            select.append('<option value=";margin-bottom;">margin-bottom</option>');
            select.append('<option value=";padding-top;">padding-top</option>');
            select.append('<option value=";padding-bottom;">padding-bottom</option>');
            select.append('<option value=".gs_inner;margin-top;">inner margin-top</option>');
            select.append('<option value=".gs_inner;margin-bottom;">inner margin-bottom</option>');
            select.append('<option value=".gs_inner;padding-top;">inner padding-top</option>');
            select.append('<option value=".gs_inner;padding-bottom;">inner padding-bottom</option>');

            var input = $('<input type="number">');
            input.val(parseInt(row.css('border')));

            function rgb2hex(rgb) {
                var hexDigits = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "a", "b", "c", "d", "e", "f"];
                rgb = rgb.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);
                function hex(x) {
                    return isNaN(x) ? "00" : hexDigits[(x - x % 16) / 16] + hexDigits[x % 16];
                }
                if (!rgb) {
                    return "";
                }
                return hex(rgb[1]) + hex(rgb[2]) + hex(rgb[3]);
            }

            function updateFromInput() {
                var attr = select.val().split(";");
                var val = $(this).val();
                if (val < 0) {
                    $(this).val(0);
                }
                var setrow = row;
                if (attr[0] !== "") {
                    setrow = row.find(attr[0]);
                }

                setrow.css(attr[1], attr[2] + val + "px");
            }

            function updateBackgroundColor() {
                var color = $(this).val();
                var type = row.find('.gs_bg_select_row').val();
                if (type === "outer") {
                    row.css('background-image','');
                    row.css('background-color', '#' + color);
                } else {
                    row.find('.gs_inner').css('background-color', '#' + color);
                }
            }

            input.on('change', updateFromInput);
            input.on('keyup', updateFromInput);

            select.on('change', function() {
                var attr = select.val().split(";");

                var setrow = row;
                if (attr[0] !== "") {
                    setrow = row.find(attr[0]);
                }

                input.val(parseInt(setrow.css(attr[1])));
            });


            var bgselect = $('<select class="gs_bg_select_row"></select>');
            bgselect.append('<option value="outer">' + __f("Background color") + '</option>');
            bgselect.append('<option value="inner">' + __f("Inner background color") + '</option>');
            var bginput = $("<input>");
            bginput.val(rgb2hex(row.css('background-color')));
            if(row.attr('style').indexOf('image') !== -1) {
                bginput.val(row.css('background-image'));
            }
            
            bginput.on('keyup', updateBackgroundColor);
            bginput.on('change', updateBackgroundColor);

            bgselect.on('change', function() {
                if ($(this).val() === "outer") {
                    if(row.attr('style').indexOf('image') !== -1) {
                        bginput.val(row.css('background-image'));
                    } else {
                        bginput.val(rgb2hex(row.css('background-color')));
                    }
                } else {
                    bginput.val(rgb2hex(row.find('.gs_inner').css('background-color')));
                }
            });

            bginput.ColorPicker({
                color: '#' + bginput.val(),
                onShow: function(colpkr) {
                    $(colpkr).fadeIn(500);
                    return false;
                },
                onHide: function(colpkr) {
                    $(colpkr).fadeOut();
                    return false;
                },
                onSubmit: function(hsb, hex, rgb, el) {
                    $(el).val(hex);
                    $(el).ColorPickerHide();
                    thundashop.MainMenu.setNewColor(hex);
                },
                onChange: function(hsb, hex, rgb) {
                   bginput.val(hex);
                   bginput.change();
                }
            });


            var inner = $('<span class="gs_margin_inner"></span>');
            inner.append('<div style="padding-bottom:5px">' + __f('Css attribute') + '</div>');
            inner.append(select);
            inner.append(input);
            inner.append('<div style="padding-bottom:5px; padding-top: 5px; border-top: solid 1px #BBB; margin-top: 10px; ">' + __f('Colors') + '</div>');
            inner.append(bgselect);
            inner.append(bginput);
            inner.append(save);
            inner.append(close);
            inner.hide();
            $(this).html(inner);
            
            /**
             * Thanks to  Atle Mo and his subtle patterns for the this patterns:
             * http://www.subtlepatterns.com/
             */
            var patterns = $('<span class="patterns"></span>');
            for(key in subtlepatterns) {
                patterns.append($('<span class="pattern" style="background-image:url(\'skin/default/images/subtlepatterns/'+subtlepatterns[key]+'\');"></span>'));
            }
            inner.append(patterns);
            
            patterns.on('click','.pattern', function() {
                bginput.val($(this).css('background-image'));
               row.css('background-image',$(this).css('background-image')); 
               row.css('background-color',""); 
            });
            
            inner.fadeIn();
        });
    },
    hideMarginOperations: function() {
        $('.gs_margin_operations').each(function() {
            if (!$(this).hasClass('expanded')) {
                $(this).remove();
            }
        });
    },
    loadMarginOperations: function() {
        if ($(this).prev('.gs_margin_operations').length > 0) {
            return;
        }
        var gear = $('<div class="gs_margin_operations fa fa-adjust"></div>');
        gear.on('click', thundashop.MainMenu.marginGearClicked);
        gear.css('top', $(this).offset().top + 3);

        $(this).prepend(gear);
    }, reorderApplicationClicked: function() {
        $('.app:not(.systemapplication)').each(function() {
            $(this).find('.mask').hide();
        });
        var show = true;
        $('.app:not(.systemapplication)').each(function() {
            if ($(this).attr('appid')) {
                $(this).find('.order_mask').addClass('delete');
                if ($(this).find('.order_mask').css('display') === 'table') {
                    $(this).find('.order_mask').css('display', 'none');
                    show = false;
                } else {
                    $(this).find('.order_mask').hide();
                    $(this).find('.order_mask').css('display', 'table');
                    $(this).find('.order_mask').fadeIn();

                    var ordermask = $(this).find('.order_mask');
                    thundashop.MainMenu.setDraggable(ordermask);
                }
            }
        });
        if (show) {
            $(document).on('mouseenter', '.gs_row', thundashop.MainMenu.loadMarginOperations);
            $(document).on('mouseleave', '.gs_row', thundashop.MainMenu.hideMarginOperations);
        } else {
            $(document).off('mouseenter', '.gs_row', thundashop.MainMenu.loadMarginOperations);
            $('.gs_margin_operations').remove();
            $('.gs_row_seperator').remove();
        }
    },
    setDraggable: function(ordermask) {
        var appid = ordermask.closest('.app').attr('appid');
        var type = ordermask.closest('.applicationarea').attr('type');
        var area = ordermask.closest('.applicationarea').attr('area');
        var areaobject = ordermask.closest('.applicationarea');

        ordermask.width(ordermask.closest('.app').width() - 2);
        ordermask.height(ordermask.closest('.app').height());


        ordermask.draggable({
            "revert": function(obj) {
                if (obj && obj.hasClass('ui-droppable')) {
                    return false;
                }
                return true;
            },
            "start": function() {
                var dragArea = $(this);
                dragArea.css('z-index', 11111);
                $('.app:not(.systemapplication)').each(function() {
                    $(this).find('.order_mask').droppable({hoverClass: "drop-hover",
                        tolerance: "pointer",
                        "drop": function() {
                            dragArea.css('z-index', 10);

                            var droparea = $(this).closest('.applicationarea').attr('area');
                            var dropareaobj = $(this).closest('.applicationarea');
                            var data = {
                                "area": area,
                                "newarea": droparea
                            };
                            var event = thundashop.Ajax.createEvent('', 'switchArea', null, data);
                            thundashop.Ajax.postWithCallBack(event, function() {
                                $('.app:not(.systemapplication) .ui-droppable').droppable('destroy');
                                $('.order_mask').css('left', '0');
                                $('.order_mask').css('top', '0');

                                var droparehtml = dropareaobj.html();
                                dropareaobj.html(areaobject.html());
                                areaobject.html(droparehtml);

                                thundashop.MainMenu.setDraggable(dropareaobj.find('.order_mask'));
                                thundashop.MainMenu.setDraggable(areaobject.find('.order_mask'));
                                thundashop.common.setSizeClasses();
                                thundashop.common.resizeOrderMask();
                            });
                        }
                    });
                    $(this).find('.order_mask').find('.inner').html(__f("Drop to reorder"));
                });
            },
            "stop": function() {
                $(this).css('z-index', 10);
                $('.app:not(.systemapplication) .ui-droppable').droppable('destroy');
                $('.order_mask').css('left', '0');
                $('.order_mask').css('top', '0');
                $('.app:not(.systemapplication) .order_mask .inner').html(__f("Drag to reorder"));
            }
        });
    },
    displayIntroductionMovie: function() {
        var event = thundashop.Ajax.createEvent('MainMenu', "displayIntroductionMovie", null, null);
        thundashop.common.showInformationBox(event);
    },
    displayFeedBack: function() {
        var helpbox = $('.helpbox');
        helpbox.fadeOut(function(e) {
            helpbox.css('left', '');
            helpbox.css('right', '10px');
            helpbox.find('.helpboxarrow').css('left', '350px');
            helpbox.find('.step').hide();
            helpbox.find('.prev').hide();
            helpbox.find('.next').hide();
            helpbox.find('.feedback').show();
            helpbox.find('.send_feedback').show();
            helpbox.find('.close_feedback').show();
            helpbox.fadeIn();
        });
    },
    moveApplication: function(direction, appid) {
        var data = {
            "direction": direction,
            "appid": appid
        };

        var event = thundashop.Ajax.createEvent(null, "moveApplication", null, data);
        thundashop.Ajax.post(event);

    },
    configureApplicationClicked: function(application) {
        this.unlockScroll();
        $('.mask').hide();
        var event = thundashop.Ajax.createEvent('MainMenu', "showConfigurationMenu", application, null);
        thundashop.common.showInformationBox(event);
    },
    addApplicationClicked: function(area, size, type) {

        $('.mask').hide();
        var data = {
            area: area,
            size: size,
            type: type
        };

        var event = thundashop.Ajax.createEvent('MainMenu', "showApplications", null, data);
        thundashop.common.showInformationBox(event, __f('Add application'));
    },
    importApplicationClicked: function(area, type) {
        var data = {
            area: area,
            type: type,
            action: "import"
        };

        var event = thundashop.Ajax.createEvent('MainMenu', "showApplications", null, data);
        thundashop.common.showInformationBox(event, __f('Import application'));
    },
    displayAllTheemes: function() {
        $('.mask').hide();
        var data = {
            type: "themes"
        };

        var event = thundashop.Ajax.createEvent('MainMenu', "showApplications", null, data);
        thundashop.common.showInformationBox(event, __f("Select your theme"));
    },
    lockScroll: function() {
        thundashop.common.currentScroll = $(window).scrollTop();
    },
    unlockScroll: function() {
//        $(window).scrollTop(thundashop.common.currentScroll);
    },
    displayAllUsers: function() {
        $('.mask').hide();
        var event = thundashop.Ajax.createEvent('MainMenu', "displayAllUsers", null, null);
        thundashop.common.showInformationBox(event);
    },
    hideFeedBack: function() {
        var helpbox = $('.helpbox');
        helpbox.fadeOut();
    },
    sendFeedBack: function() {
        var helpbox = $('.helpbox');
        var data = {
            text: helpbox.find('.feedbacktext').val()
        };
        var event = thundashop.Ajax.createEvent('ApplicationManager', "sendFeedback", null, data);
        thundashop.Ajax.post(event);
        thundashop.MainMenu.hideFeedBack();
    },
    updateUserLevel: function(userlevel) {
        var data = {
            "userlevel": userlevel
        };
        var event = thundashop.Ajax.createEvent('ApplicationManager', 'updatePageUserLevel', null, data);
        thundashop.Ajax.post(event);
    },
    hideMenu: function() {
        $('.spacingtop').slideUp();
        $('.mainmenu .content').slideUp();
        $('.mainmenu .hide div').html('show mainmenu');
        thundashop.MainMenu.hidden = true;
    },
    changeLayout: function(type) {
        var target = $('#mainmenu');
        var pageId = $('.skelholder').find('#pageid').attr('value');

        data = {
            pageId: pageId,
            type: type
        };
        var event = thundashop.Ajax.createEvent('MainMenu', "changeLayout", target, data);
        thundashop.Ajax.postSynchronWithReprint(event);
    },
    showPageSettings: function() {
        alert('test');
    },
    importProductList: function(list) {
        var data = {
            "list": list
        };

        var event = thundashop.Ajax.createEvent("", "importApplication", thundashop.MainMenu.selectedTarget, data);
        thundashop.Ajax.post(event);
    },
    goToStoresettings: function() {
        var event = thundashop.Ajax.createEvent("", "displayPageSettings", null, {});
        thundashop.common.showInformationBox(event, __f("Page Settings"));
    },
    loadAdvancedColors: function() {
        var selectionbox = $('.designselectionbox');
        selectionbox.find('.colorpicker_selection').hide();
        if (selectionbox.find('.advanced_options').is(':visible')) {
            selectionbox.find('.advanced_options').fadeOut(function() {
                selectionbox.find('.colorselection').animate({width: '242px'}, 'fast');
                selectionbox.find('.colorselectbox').show();
            });
        } else {
            selectionbox.find('.colorselection').animate({width: '305px'}, 'fast', function() {
                var theme = $('.skelholder').attr('theme');
                selectionbox.find('.colorselectbox').fadeOut(function() {
                    selectionbox.find('.advanced_options').fadeIn();
                });
                selectionbox.find('.advanced_colors').hide();
                selectionbox.find('.advanced_colors[panel="' + theme + '"]').show();
            });
        }
    },
    loadAdvancedColorSelection: function() {
        var selectionbox = $('.designselectionbox');
        var path = $(this).attr('path');
        var type = $(this).attr('type');

        if (type.indexOf(',') !== -1) {
            type = type.split(',');
            type = type[0];
        }
        var color = $(path).css(type);
        $('.advanced-color.selected').removeClass('selected');
        $(this).addClass('selected');

        function rgb2hex(rgb) {
            rgb = rgb.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);
            function hex(x) {
                return ("0" + parseInt(x).toString(16)).slice(-2);
            }
            return hex(rgb[1]) + hex(rgb[2]) + hex(rgb[3]);
        }
        if (color === undefined) {
            color = "";
        }
        if (color.indexOf('rgba') !== -1) {
            color = "";
        } else if (color.indexOf('rgb') !== -1) {
            color = rgb2hex(color);
        }
        $('.colorpicker').remove();
        selectionbox.find('.colorpicker_selection').show("slide", {direction: "down"}, 300);
        selectionbox.find('.selection_text').html($(this).html());
        var input = $('<input>');
        input.val(color);

        selectionbox.find('.colorpickerinput').html(input);
        input.ColorPicker({
            color: '#' + color,
            onShow: function(colpkr) {
                $(colpkr).fadeIn(500);
                return false;
            },
            onHide: function(colpkr) {
                $(colpkr).fadeOut();
                return false;
            },
            onSubmit: function(hsb, hex, rgb, el) {
                $(el).val(hex);
                $(el).ColorPickerHide();
                thundashop.MainMenu.setNewColor(hex);
            },
            onChange: function(hsb, hex, rgb) {
                $('#colorSelector div').css('backgroundColor', '#' + hex);
            }
        });
    },
    setNewColor: function(color) {
        var selectedbox = $('.designselectionbox .advanced-color.selected');
        var type = selectedbox.attr('type');
        var path = selectedbox.attr('path');
        if (type === "background-color" && path === "body") {
            $('body').css('background-image', 'none');
        }

        if (type.indexOf(",") !== -1) {
            var array = type.split(",");
        }
        var data = {
            "path": path,
            "type": type,
            "color": color
        }

        if (array !== undefined) {
            for (var key in array) {
                data['type'] = array[key];
                var event = thundashop.Ajax.createEvent("", "SaveColorAttribute", $(this), data);
                thundashop.Ajax.postWithCallBack(event, function(data) {
                    $('body').find('#set_colors').remove();
                    $('body').append(data);
                });
            }
        } else {
            var event = thundashop.Ajax.createEvent("", "SaveColorAttribute", $(this), data);
            thundashop.Ajax.postWithCallBack(event, function(data) {
                $('body').find('#set_colors').remove();
                $('body').append(data);
            });
        }
    },
    moveRow: function() {
        var elmnt = $(this);
        var element = $(this).closest('.gs_row');
        var curclass = element.attr('row');
        if (elmnt.hasClass('fa-arrow-circle-up')) {
            var prevelement = element.prev();
            var prevclass = prevelement.attr('row');

            prevelement.removeClass("r" + prevclass);
            prevelement.addClass("r" + curclass);
            element.removeClass("r" + curclass);
            element.addClass("r" + prevclass);

            element.attr('row', prevclass);
            prevelement.attr('row', curclass);

            prevelement.before(element);
        } else {
            var nextelement = element.next();
            var nextclass = nextelement.attr('row');
            nextelement.removeClass("r" + nextclass);
            nextelement.addClass("r" + curclass);
            element.removeClass("r" + curclass);
            element.addClass("r" + nextclass);

            element.attr('row', nextclass);
            nextelement.attr('row', curclass);

            nextelement.after(element);
        }
    },
    showApplicationManagement: function(list) {
        var event = thundashop.Ajax.createEvent("", "displayApplicationManagement", thundashop.MainMenu.selectedTarget, {});
        thundashop.common.showInformationBox(event, __f("Application management"));
    },
    showHideDesignSelection: function() {
        var preview = $('.designselectionbox .designpreviews');
        preview.css('left', '0px');

        var width = $(window).width() - 150;
        var boxes = preview.find('.design').length;
        var boxesOver = Math.floor(width / 160);
        boxesOver = boxes - boxesOver;
        thundashop.MainMenu.designMaxSlideCount = boxesOver;
        thundashop.MainMenu.designSlideCount = 0;
        preview.find('.prev').hide();
        if (thundashop.MainMenu.designMaxSlideCount <= 0) {
            preview.find('.next').hide();
        }

        if ($('.designselectionbox').is(':visible')) {
            sliding = $('.designselectionbox').hide('slide', {direction: 'down'}, 300);
            $('body').css('margin-bottom', '0px');
            $('.')
        } else {
            sliding = $('.designselectionbox').show('slide', {direction: 'down', complete: function() {
                    if (thundashop.MainMenu.designMaxSlideCount > 0) {
                        preview.find('.next').show();
                    }
                }}, 300);
            $('body').css('margin-bottom', '200px');
        }

    }


};
$(function() {
    var preview = $('.designselectionbox .designpreviews');
    preview.on('click', '.next', function() {
        preview.animate({
            left: '-=' + 180
        }, 200);
        thundashop.MainMenu.designSlideCount++;
        if (thundashop.MainMenu.designSlideCount >= thundashop.MainMenu.designMaxSlideCount) {
            $(this).hide();
        }
        preview.find('.prev').show();
    });
    preview.on('click', '.prev', function() {
        preview.animate({
            left: '+=' + 180
        }, 200);
        thundashop.MainMenu.designSlideCount--;
        if (thundashop.MainMenu.designSlideCount === 0) {
            preview.find('.prev').hide();
        }
        if (thundashop.MainMenu.designSlideCount < thundashop.MainMenu.designMaxSlideCount) {
            preview.find('.next').show();
        }
    });
});

$('#addapplicationsbutton:not(.disabled)').live('click', function() {
    thundashop.MainMenu.showAddApplication();
});

$('.add_application_menu .button-large').live('click', function() {
    var area = $(this).attr('type');
    var size = $(this).closest('.applicationarea').attr('size');
    var type = $(this).closest('.applicationarea').attr('type');
    thundashop.MainMenu.addApplicationClicked(area, size, type);
});

$('.add_application_menu .importtext').live('click', function(e) {
    var area = $(this).closest('.applicationarea').attr('area');
    var type = $(this).closest('.applicationarea').attr('type');
    thundashop.MainMenu.importApplicationClicked(area, type);
});

$('#displaytheemesbutton:not(.disabled)').live('click', function() {
    thundashop.MainMenu.showHideDesignSelection();
});
$(document).on('click', '.designselectionbox .close', function() {
    thundashop.MainMenu.showHideDesignSelection();
});

$('#displayfeedback').live('click', function() {
    thundashop.MainMenu.displayFeedBack();
});

$('#opensupportcenter').live('click', function() {
    window.open('http://support.getshop.com/', 'new');
});

$('#displayintroductionmoviebutton').live('click', function() {
    thundashop.MainMenu.displayIntroductionMovie();
});

$('.helpbox .close_feedback').live('click', function() {
    thundashop.MainMenu.hideFeedBack();
});

$('#appmanagementbutton').live('click', function() {
    thundashop.MainMenu.showApplicationManagement();
});

$('.helpbox .send_feedback').live('click', function() {
    thundashop.MainMenu.sendFeedBack();
});

$('.mainmenu .group .entry .page').live('click', function() {

});

$('#displayuserssbutton:not(.disabled)').live('click', function() {
    thundashop.MainMenu.displayAllUsers();
});

$('.renderstandalone').live('click', function() {
    var appName = $(this).attr('appid');
    window.open("index.php?page=" + appName + "_standalone", "window", "height=600, width=800");
});

$('#deleteapplication:not(.disabled)').live('click', function() {
    thundashop.MainMenu.deleteApplicationClicked();
});
$('#reorderapplication:not(.disabled)').live('click', function() {
    thundashop.MainMenu.reorderApplicationClicked();
});

$('.order_mask .inner .reorder_up, .order_mask .inner .reorder_down').live('click', function(e) {
    var id = $(this).closest('.app').attr('appid');
    if ($(this).hasClass('reorder_down')) {
        thundashop.MainMenu.moveApplication('down', id);
    } else {
        thundashop.MainMenu.moveApplication('up', id);
    }
})

$('.mask.delete').live('click', function() {
    var id = $(this).closest('.app').attr('appid');
    var area = $(this).closest('.app').attr('apparea');
    thundashop.Skeleton.removeApplication(id, area);
});

$('.mainmenu #appotionsbutton:not(.disabled)').live('click', function() {
    if ($('.mainmenu .appoptionsdropdown').is(':visible')) {
        $('.mainmenu .appoptionsdropdown').slideUp();
    } else {
        $('.mainmenu .appoptionsdropdown').slideDown();
    }
});

$('#showsecurity:not(.disabled)').live('click', function() {
    if (!$('.mainmenu .security .dropdown').is(':visible')) {
        $('.mainmenu .security .dropdown').slideDown();
    } else {
        $('.mainmenu .security .dropdown').slideUp();
    }
});
$(document).live('click', function(e) {
    if ($('.mainmenu .security .dropdown').is(':visible') && $(e.target).parents('.mainmenu').length == 0) {
        $('.mainmenu .security .dropdown').slideUp();
    }
    if ($('.mainmenu .appoptionsdropdown').is(':visible') && $(e.target).parents('.mainmenu').length == 0) {
        $('.mainmenu .appoptionsdropdown').slideUp();
    }
});
$('.mainmenu .allow_access_entry').live('click', function(e) {
    $('.mainmenu .security .dropdown .selected').removeClass('selected');
    $(this).find('.selection').addClass('selected');
    thundashop.MainMenu.updateUserLevel();
});

$('.innerskeletondisplayer').live('click', function(ev) {
    var skeleton = $(this).attr('skeleton');
    thundashop.MainMenu.changeLayout(skeleton);
    thundashop.common.hideInformationBox(null);
});

$('.theeme_selection').live('click', function(e) {
    var type = $(this).attr('type');
    window.location.href = '?setTheeme=' + type;
});

$(document).on('click', '.no_page_layout .click', function() {
    thundashop.MainMenu.showPageLayoutSelection();
});

$('.informationbox .applicationamanagement .deleteapp').live('click', function(e) {
    $('.informationbox .applicationamanagement .showdeleteappwarning').slideDown();
});

$('.deletestore').live('click', function(e) {
    var r = confirm(__f("Sorry to hear that, Are you sure that you want to delete your store?"));
    if (r === true) {
        var event = new thundashop.Ajax.createEvent("MainMenu", "deleteStore");
        thundashop.Ajax.post(event);
        $('html').html('<center>' + __f("Your site has been deleted") + '</center>');
    }
});

$('.mainmenu .hide div').live('click', function(e) {
    if (thundashop.MainMenu.hidden) {
        $('.spacingtop').slideDown();
        $('.mainmenu .content').slideDown();
        $('.mainmenu .hide div').html('hide mainmenu');
        thundashop.MainMenu.hidden = false;
    } else {
        thundashop.MainMenu.hideMenu();
    }

});
$(function() {
    $('.designselectionbox').on('click', '.design', thundashop.MainMenu.selectDesign);
    $('.designselectionbox').on('click', '.background', thundashop.MainMenu.setDesignVariation);
    $('.designselectionbox').on('click', '.color', thundashop.MainMenu.setDesignVariation);
    $('.designselectionbox').on('click', '.advanced_color_selection', thundashop.MainMenu.loadAdvancedColors);
    $('.designselectionbox').on('click', '.close_advanced_options', thundashop.MainMenu.loadAdvancedColors);
    $('.designselectionbox').on('click', '.advanced-color', thundashop.MainMenu.loadAdvancedColorSelection);
    $(document).on('click', '.gs_reorder_row .fa-arrow-circle-up', thundashop.MainMenu.moveRow);
    $(document).on('click', '.gs_reorder_row .fa-arrow-circle-down', thundashop.MainMenu.moveRow);
});

