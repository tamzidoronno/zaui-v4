<?php
/* @var $this \ns_d3951fc4_6929_4230_a275_f2a7314f97c1\PmsBookingContactData */
$config = $this->getConfigurationToUse();

echo "<div gstype='form' method='submitForm'>";
foreach($config->data as $key => $value) {
    /* @var $value core_bookingengine_data_RegistrationRulesField */
    if(stristr($key, "field_")) {
        $this->printField($value);
    }
}
foreach($config->data as $key => $value) {
    /* @var $value core_bookingengine_data_RegistrationRulesField */
    if(!stristr($key, "company_") && !stristr($key, "user_") && !stristr($key, "field_")) {
        $this->printField($value);
    }
}

$completeText = $this->getConfigurationSetting("complete_order_button");
if(!$completeText) {
    $completeText = "Complete";
}
echo "<div class='chooseregform'>";
echo "<input type='radio' name='choosetyperadio' gsname='choosetyperadio' value='registration_private'> Privatperson";
echo "<input type='radio' name='choosetyperadio' gsname='choosetyperadio' value='registration_company'> Organisasjon";
echo "</div>";

echo "<div class='registration_private regforminput'>";
$this->counter = 0;
foreach($config->data as $key => $value) {
    /* @var $value core_bookingengine_data_RegistrationRulesField */
    if(stristr($key, "user_")) {
        $this->printField($value);
    }
}
echo "</div>";

echo "<div class='registration_company regforminput'>";
$this->counter = 0;
foreach($config->data as $key => $value) {
    /* @var $value core_bookingengine_data_RegistrationRulesField */
    if(stristr($key, "company_")) {
        $this->printField($value);
    }
}
echo "</div>";

$config = $this->getApi()->getPmsManager()->getConfiguration($this->getSelectedName());

echo "<div class='whenTypeIsSelected'>";
if($config->needToAgreeOnContract) {
    echo "<div>";
    echo "<span class='col-50'><div style='padding-bottom: 5px;'><input type='checkbox' gsname='agreetoterms'> ". $this->__w("I agree to the terms and conditions");
      echo "<span class='errordesc'>";
        if(isset($this->validation['agreetoterms'])) {
            echo "* " . $this->validation['agreetoterms'];
        } else {
            echo "&nbsp;";
        }
        echo "</span>";

        echo "</label>";
    echo "</div>";
    echo "<a class='termsandcondtext' onclick=\"window.open('/scripts/loadContractPdf.php?readable=true&engine=".$this->getSelectedName()."');\" >". $this->__w("Read the terms and conditions")."</a><br>";
    echo "<a class='termsandcondtext' onclick=\"window.open('/scripts/loadContractPdf.php?engine=".$this->getSelectedName()."');\">". $this->__w("Download the terms and conditions")."</a>";
    echo "</span>";
    echo "<span class='col-50' style='padding-right:0px;'><span class='complete_button' gstype='submit'>$completeText</span></span>";
    echo "</div>";
} else {
    echo "<span class='complete_button' gstype='submit'>$completeText</span>";
}
echo "</div>";
echo "<div style='clear:both;'></div>";
echo "</div>";

$curAddedFields = $this->getCurrentBooking()->registrationData->resultAdded;
if(isset($curAddedFields->{'choosetyperadio'})) {
    echo "<script>";
    echo "$('input[name=\"choosetyperadio\"][value=\"".$curAddedFields->{'choosetyperadio'}."\"]').click();";
    echo "</script>";
} else {
    echo "<script>";
    echo "$('input[name=\"choosetyperadio\"][value=\"registration_private\"]').click();";
    echo "</script>";
}

?>