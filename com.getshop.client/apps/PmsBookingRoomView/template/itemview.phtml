<?
/* @var $this \ns_f8cc5247_85bf_4504_b4f3_b39937bd9955\PmsBookingRoomView */
$savedRoom = $this->getSelectedRoom();
$room = $this->getTmpSelectedRoom($savedRoom->pmsBookingRoomId);
$hasAcessControl = $this->getApi()->getPmsManager()->hasLockSystemActive($this->getSelectedMultilevelDomainName());

$types = $this->getTypes();
$items = $this->getItems();

$selectedType = $this->getSelectedTypeForRoom();
$selectedItem = $this->getSelectedItemForRoom();

$warnAboutUnchanges = "";

$startDate = strtotime($room->date->start);
$endDate = strtotime($room->date->end);

$booking = $this->getPmsBooking();
$validSelection = $this->isValidSelection($room);

if(!isset($room->tmpModified) || !$validSelection) {
    $warnAboutUnchanges = "display:none;";
}

if(stristr($booking->channel, "wubook_")) {
    echo "<div style='padding: 10px; background-color:red; color:white;'>";
    echo "Be careful doing changes in this area. The booking is connected to an OTA and should be changed by them. They can be overwritten and in worse case cenario cause overbooking, read more about overbookings <a href='https://getshop.com/double_booking_error.html' target='_fsdaf' style='color:cyan;'>here</a>.";
    echo "</div>";
}

?>

<div style="border: solid 1px; text-align: right;background-color:red; color:#fff;<?php echo $warnAboutUnchanges; ?>" class="warningchangesonroom"><span style='float:left; margin-top: 8px;margin-left:8px;'>You have modified this room and need to save it to be completed</span> <span class="shop_button savetmproom" roomid='<?php echo $room->pmsBookingRoomId; ?>'>save changes on room</span></div>
<div class="outerstay">
    <div class='itemview_inner stayperiodecontainer'>
        <h2>Stay periode</h2>
        Check-in<br>
        <input type="textfield" class="gsniceinput1 startdate" gsname="start" value="<? echo date("d.m.Y", $startDate); ?>"/>
        <input type="textfield" class="gsniceinput1 starttime time starttime" gsname="startTime" value="<? echo date("H:i", $startDate); ?>"/><br><br>
        Check-out<br>
        <input type="textfield" class="gsniceinput1 enddate" gsname="end" value="<? echo date("d.m.Y", $endDate); ?>"/> 

        <input type="textfield" class="gsniceinput1 endtime time endtime" gsname="endTime" value="<? echo date("H:i", $endDate); ?>"/> 
        <?php
        if(isset($room->warningText)) {
            echo "<div style='font-weight:bold; color:red;'><i>" . $room->warningText . "</i></div>";
        }
        ?>
        <span class='shop_button setnewdates' style='width:100%;margin-top:5px;box-sizing: border-box;'>Change dates</span>
        <?php
        if($this->startingToday($room) && !$room->checkedin) {
            echo "<span class='shop_button checkinguest' style='width:100%; margin-top: 5px;box-sizing:border-box; background-color:green;'>Check in guest</span>";
        } else if($room->checkedin && !$room->checkedout) {
            echo "<span class='shop_button checkoutguest' style='width:100%; margin-top: 5px;box-sizing:border-box; background-color:blue;'>Check out guest</span>";
        } else if(!$room->checkedin && $room->checkedout) {
            echo "<span class='shop_button checkoutguest' style='width:100%; margin-top: 5px;box-sizing:border-box; background-color:orange;'>Undo checkout</span>";
        }
        ?>
    </div>

    <div class='itemview_inner roomandcats'>
        <h2>Room and categories</h2>

        <?
        echo $this->__f("Selected category").": ".$selectedType->name;
        echo "<br>".$this->__f("Selected room").": ";
        if ($selectedItem) {
            echo $selectedItem->bookingItemName;
            $isClean = $this->getApi()->getPmsManager()->isClean($this->getSelectedMultilevelDomainName(), $selectedItem->id);
            if($isClean) {
                echo "<div>Room is clean</div>";
            } else {
                echo "<div>Room is <b>not</b> clean</div>";
            }
        } else {
            echo $this->__f("Floating");
        }
        if(!$validSelection) {
            echo "<div class='notvalidselection'>This room selection is not valid.</div>";
        }

        ?>
        <br/>
        <br/>
        <div class="shop_button showroomstoselect"><? echo $this->__f("Change room or category"); ?></div>
        <?php if(!$savedRoom->deleted && !$savedRoom->addedToWaitingList) { ?>
           <span class='shop_button' gsclick='deleteRoom' style='bottom:-27px;background-color:red;'>Cancel this room</span>
        <?php } ?>
    </div>

    <div class='itemview_inner pricesview'>
        <? $this->includefile("prices"); ?>
    </div>
</div>
<div class="itemview_inner roomstoselect" style="display: none;"></div>
<div style="border: solid 1px; text-align: right;background-color:red; color:#fff; <?php echo $warnAboutUnchanges; ?>" class="warningchangesonroom"><span style='float:left; margin-top: 8px;margin-left:8px;'>You have modified this room and need to save it to be completed</span> <span class="shop_button savetmproom" roomid='<?php echo $room->pmsBookingRoomId; ?>'>save changes on room</span></div>
