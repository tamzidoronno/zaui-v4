<?php
/* @var $this ns_27e174dc_b08c_4bf7_8179_9ea8379c91da\PmsEventCalendar */
$cats = $this->getCategories();
$datelist = array();
foreach($this->getEventList() as $eventEntry) {
    foreach($eventEntry->dateRanges as $idx => $range) {
        $start = strtotime($range->start);
        $datelist[] = $eventEntry;
        $sortList[] = $start;
    }
}

asort($sortList);

$today = strtotime(date("d.m.Y 06:00", time()));

echo "<table>";
$i = 0;
foreach($sortList as $idx => $date) {
    if($date < $today) {
        continue;
    }
    $eventEntry = $datelist[$idx];
    echo "<tr>";
    echo "<td valign='top' class='datecol'><div>".date("d.", $date)."</div><div>".date("M", $date)."</div></td>";
    echo "<td valign='top' class='listtext'>";
    $shortId = explode("-", $eventEntry->id);
    $edit = "";
    if($this->isEditorMode()) {
        $edit = "<a><i class='fa fa-trash-o'  gstype='clicksubmit' method='removeEntry' gsname='id' gsvalue='".$eventEntry->id."' ></i></a> ";
        $edit .= "<a href='?page=".$this->getPage()->javapage->id."&eventid=".$eventEntry->id."'><i class='fa fa-edit'></i></a> ";
    }
    echo "<h2>" . $edit . "<a href='?page=".$this->getPage()->javapage->id."&readevent=".$shortId[0]."'>" . $eventEntry->title  . "</a></h2>";

    echo "<div class='arrangedby'>" . $eventEntry->arrangedBy . "</div>";
    if(isset($cats[$eventEntry->category])) {
        echo "<div><span class='cat'>" . $cats[$eventEntry->category] . "</span></div>";
    }
    echo nl2br(trim($eventEntry->shortdesc)) . "<br>";
    if(!$eventEntry->starttime) {
        $eventEntry->starttime = date("H:i", strtotime($eventEntry->dateRanges[0]->start));
    }
    
    echo "<br>" . $eventEntry->starttime;
    echo "<a href='?page=".$this->getPage()->javapage->id."&readevent=".$shortId[0]."' style='float:right;'>Les mer</a><br><br>";
    echo "</td>";
    echo "<tr>";
    $i++;
    if($i > 50) {
        break;
    }
}
echo "</table>";
?>