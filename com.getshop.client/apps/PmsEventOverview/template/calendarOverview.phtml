<?php
/* @var $this \ns_8bfb1ed3_aac1_48b9_a6d3_cf7c3d59b944\PmsEventOverview */
$rooms = $this->getAllRoomsSorted();
$types = $this->getAllTypes();
$type = $this->getDayType();
?>

<div class="calendarSettings">
    <i class="fa fa-th active"></i>
    <i class="fa fa-list-ul"></i>
    <i class="fa fa-cog"></i>
</div>

<div id="calendarConfiguration">
    <span class="configheader"><?php echo $this->__w("Visibility"); ?></span>
    <ul>
        <li class="toggleborders"><?php echo $this->__w("Borders"); ?></li>
        <li class="toggleoccupied active"><?php echo $this->__w("Occupied"); ?></li>
        <li class="togglenotconfirmed active"><?php echo $this->__w("Not confirmed"); ?></li>
        <li class="toggleopenforpublic active"><?php echo $this->__w("Open for public"); ?></li>
        <li class="toggleavailable active"><?php echo $this->__w("Available"); ?></li>
        <li class="togglenotavailable"><?php echo $this->__w("Not available"); ?></li>
    </ul>
    
</div>

<div class='calendartopheader'>
    <div class='dayorweekdiv'>
        <span class="stateinformtaion">
            <div class='statedesrow occupied' style="background-color: transparent !important;"><span class='statedescbox occupied'></span> <?php echo $this->__w("Occupied"); ?></div>
            <div class='statedesrow notconfirmed' style="background-color: transparent !important;"><span class='statedescbox notconfirmed'></span> <?php echo $this->__w("Not confirmed"); ?></div>
            <div class='statedesrow openforpublic' style="background-color: transparent !important;"><span class='statedescbox openforpublic'></span> <?php echo $this->__w("Open for public"); ?></div>
            <div class='statedesrow available' style="background-color: transparent !important;"><span class='statedescbox available'></span> <?php echo $this->__w("Available"); ?></div>
            <div class='statedesrow not_available hidden' style="background-color: transparent !important;"><span class='statedescbox not_available'></span> <?php echo $this->__w("Not available"); ?></div>
        </span>
        <div class='dayorweekdivbuttons'>
            <span style='padding-right: 30px; cursor:pointer;float:left;' gstype="clicksubmit" method="setPrevious" gsname="type" gsvalue="day">
                <i class='fa fa-caret-left'></i> <? echo $this->__w("Previous")." ".$this->__w("month"); ?>
            </span>
            <?php echo $this->__w(date("F Y", $this->getSelectedDay()));?>
            <span style='padding-left: 30px; cursor:pointer;float:right;' gstype="clicksubmit" method="setNext" gsname="type" gsvalue="day">
                <? echo $this->__w("Next")." ".$this->__w("month"); ?> <i class='fa fa-caret-right'></i>
            </span>
        </div>
    </div>
</div>
<?


echo "<div class='roomrow'>";
echo "<span style='float:none;' class='roomdescouter roomdesc_$type'></span>";
echo "<span class='timecontainer timecontainer_$type'>";

$start = $this->getStartOfSelectedWeek();
for($i = 0; $i < 7; $i++) {
    $this->printHeader($start);
    $start += 86400;
}

echo "<div style='clear:both;'></div>";
echo "</span>";
echo "</div>";


$dates = $this->getDates($this->getSelectedYear());
$month = $this->getSelectedMonth();
$year = $this->getSelectedYear();
$monthDates = $dates[$month];

$typeToUse = null;
foreach($types as $room) {
    if($this->isItemPage()) {
        if($room->pageId == $this->getPage()->javapage->id) {
            $typeToUse = $room;
        }
    }
}


foreach($monthDates as $week => $days) {
//    echo "<div class='roomrow itemlist' itemid='".$typeToUse->id."'>";
    
    echo "<div class='roomrow itemlist'>";
    
    echo "<span class='roomdescouter roomdesc_$type'>";
    echo "<div class='roomdesc'>". $this->__w("Week"). " ".$week."</div>";
    foreach ($types as $room){
        $imgId = $this->getImageFromPage($room->pageId);
//        echo "<img src='displayImage.php?id=$imgId'>";
        echo "<img src='https://frivillighetenshus.getshop.com/displayImage.php?id=$imgId'>";
        echo $room->name ."<br>";
    }

    echo "</span>";

    echo "<span class='timecontainer timecontainer_$type'>";
    for($i = 1; $i <= 7; $i++) {
        $day="";
        if(isset($days[$i])) {
            $day = $days[$i]."-".$month."-".$year;
        }

        echo "<div class='weekdaycontainer'>";
        if($day) {
            echo "<div class='dayindicator'>".date("d", strtotime($day));
            echo "<span class='daytime'style='left:8px;'>".date("H:i", $this->getStartTime($start)) ."</span>";
            echo "<span class='daytime'style='right:8px;'>".date("H:i", $this->getEndTime($start)) ."</span>";
            echo "</div>";
            
            foreach($types as $room) {
                $this->printBlocks(strtotime($day), $type, $room->id);
            }
        }
        echo "</div>";
    }
    echo "</span>";
    echo "</div>";
 }
     
$nextPage = $this->__w("summary") . "_" . $this->getSelectedName();
echo "<input type='hidden' class='continue' value='$nextPage'>";

?>
<input type='hidden' class='continue_button disabled continue' value="<?php echo $nextPage; ?>">
<link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
