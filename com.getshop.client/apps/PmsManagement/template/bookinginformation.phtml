<?
/* @var $this ns_7e828cd0_8b44_4125_ae4f_f61983b01e0a\PmsManagement */

if(sizeof($this->errors) > 0) {
    echo "<h2>Error</h2>";
    echo "<div class='errorlist'>";
    foreach($this->errors as $error) {
        echo $error;
    }
    echo "</div>";
}

$bookingid = $_POST['data']['bookingid'];

$pmsManager = $this->getApi()->getPmsManager();
$config = $pmsManager->getConfiguration($this->getSelectedName());

$lang = $this->getFactory()->getCurrentLanguage();
$default =  $pmsManager->getDefaultMessage($this->getSelectedName(), $bookingid);
$types = $this->getApi()->getBookingEngine()->getBookingItemTypes($this->getSelectedName());
foreach ($types as $idx => $type) {
    $types[$type->id] = $type;
}

$booking = $pmsManager->getBooking($this->getSelectedName(), $bookingid);

if(!$booking->confirmed) {
    ?>
    <div class='needconfirmation'>
        <?php if($booking->unConfirmed) {
            echo "This booking has been rejected by administrator.";
        } else {
            ?>
            This booking has not been confirmed yet.<br>
        <?php } ?>
    </div>
    <?php
}

echo "<div class='bookinginfo'>";
$this->includefile("contactdata");
echo "<div style='clear:both;'></div>";
$this->includefile("roomsbooked");
$this->includefile("addons");
if($config->requirePayments) {
    $this->includefile("orderinformation");
}

if(!$booking->confirmed) { ?>
    <div class='needconfirmation' style="margin:0px;margin-top: 20px;">
        <h2>Confirm this booking</h2>
        <div gstype="form" method="confirmBooking">
            <input type='hidden' gsname='bookingid' value='<? echo $booking->id; ?>'>
            <div style='text-align:left;'>Message to recipient:</div>
            <textarea style='width:100%; height: 100px; margin-bottom: 5px;' gsname='message'><? echo $default; ?></textarea>
            <span gstype="submit" class='pmsbutton' gsvalue='confirm'>Confirm booking</span>
            <span gstype="submit" class='pmsbutton' gsvalue='unconfirm' style='background-color:red;'>Do not confirm this booking</span>
        </div>
    </div>
<?php } ?>
<br><br><br>
<span class='pmsbutton doneediting' style='float:right;'><? echo $this->__w("Done editing"); ?></span> 
<span class='pmsbutton deletebooking' bookingid='<? echo $booking->id; ?>' style=' background-color:red;'><? echo $this->__w("Delete booking"); ?></span>
<span class='pmsbutton showlog' bookingid='<? echo $booking->id; ?>' style='background-color:yellow; color:#000;'><? echo $this->__w("Show log"); ?></span>
<div style='clear:both;'></div>
<div id="logarea"></div>
</div>