<?php
/* @var $this ns_7e828cd0_8b44_4125_ae4f_f61983b01e0a\PmsManagement */
$stats = $this->getManager()->getStatistics($this->getSelectedName(), $this->getSelectedFilter());
$filter = $this->getSelectedFilter();
$intervaloptions = array();
$intervaloptions['daily'] = "Daily";
$intervaloptions['weekly'] = "Weekly";
$intervaloptions['monthly'] = "Monthly";
$intervaloptions['yearly'] = "Yearly";
$firstWidth = 45;
if($filter->channel || sizeof($filter->typeFilter) > 0) {
    $firstWidth = 100;
}
?>
<div style='clear:both;' class='changeintervalrow'>
    <select class='changestatisticsinterval'>
        <?php
        foreach($intervaloptions as $type => $value) {
            $selected = ($type == $filter->timeInterval) ?  "SELECTED" : "";
            echo "<option value='$type' $selected>$value</option>";
        }
        ?>
    </select>
</div>
<br>
<div style='float:left; width: <?php echo $firstWidth; ?>%'>
    <table cellspacing='0' cellpadding='0' class='statisticstable' width='100%'>
        <tr>
            <th>
                <i gs_downloadexcelreport="exportBookingStats" title="Download to excel" style="cursor:pointer" class="fa fa-file-excel-o" aria-hidden="true" gs_filename="bookingdataexport"></i>
                <?php echo $this->__w("Date"); ?></th>
            <th><?php echo $this->__w("Spare<br>rooms"); ?></th>
            <th><?php echo $this->__w("Rented<br>out"); ?></th>
            <th><?php echo $this->__w("Avg.<br>price"); ?></th>
            <th><?php echo $this->__w("Total"); ?></th>
            <th><?php echo $this->__w("Budget"); ?></th>
            <th><?php echo $this->__w("Coverage"); ?></th>
        </tr>
        <?
        foreach ($stats->entries as $entry) {
            if ($entry->date) {
                $day = $this->getDayText($entry->date, $filter->timeInterval);
            } else {
                $day = "Sum";
            }
            echo "<tr class='statisticsrow' type='coverage' day='$day'>";
            echo "<td>";
                echo $day;
            echo "</td>";
            echo "<td>"; if($entry->spearRooms >= 0) { echo $entry->spearRooms; } echo "</td>";
            echo "<td>"; if($entry->roomsRentedOut >= 0) { echo $entry->roomsRentedOut; } echo "</td>";
            echo "<td>"; if($entry->avgPrice >= 0) { echo $entry->avgPrice; } echo "</td>";
            echo "<td>"; if($entry->totalPrice >= 0) { echo $entry->totalPrice; } echo "</td>";
            echo "<td>" . $entry->bugdet . "%</td>";
            if($entry->bugdet < $entry->coverage) {
                echo "<td class='budget_success'><i class='fa fa-check' style='float:right;'></i> " . $entry->coverage . "%</td>";
            } else {
                echo "<td class='budget_fail'><i class='fa fa-close' style='float:right;'></i> " . $entry->coverage . "%</td>";
            }
            echo "</tr>";
        }
        ?>
    </table>
</div>
<?php if(!$filter->channel && sizeof($filter->typeFilter) == 0) { ?>
    <div style='float:right; width: 45%'>
        <table cellspacing='0' cellpadding='0' class='statisticstable' width='100%'>
            <tr>
                <th>
                    <i gs_downloadexcelreport="exportSaleStats" title="Download to excel" style="cursor:pointer" class="fa fa-file-excel-o" aria-hidden="true" gs_filename="salestats"></i>
                    <?php echo $this->__w("Date"); ?></th>
                <th><?php echo $this->__w("Nights"); ?></th>
                <th><?php echo $this->__w("Orders"); ?></th>
                <th><?php echo $this->__w("Avg."); ?><br> order</th>
                <th><?php echo $this->__w("Total"); ?></th>
            </tr>
            <?
            foreach ($stats->salesEntries as $saleEntry) {
                $day = "";
                if ($saleEntry->date) {
                    $day = $this->getDayText($saleEntry->date, $filter->timeInterval);
                }
                echo "<tr class='statisticsrow' type='sale' day='$day'>";
                echo "<td>";
                echo $day;
                echo "</td>";
                echo "<td>" . $saleEntry->nights . "</td>";
                echo "<td>" . $saleEntry->numberOfOrders . "</td>";
                echo "<td>" . $saleEntry->avgOrderPrice . "</td>";
                echo "<td>" . $saleEntry->totalPrice . "</td>";
                echo "</tr>";
            }
            ?>
        </table>
    </div>
<? } ?>
<div style='clear:both;'></div>
