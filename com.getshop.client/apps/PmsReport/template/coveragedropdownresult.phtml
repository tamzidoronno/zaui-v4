<?php
/* @var $this ns_39fd9a07_94ea_4297_b6e8_01e052e3b8b9\PmsReport */
?>
<table width="100%">
    <tr>
        <th align='left'>Guests</th>
        <th align='left'>Price</th>
        <th align='left'>Room type</th>
        <th align='left'>Room</th>
    </tr>
    <?php
    $data = json_decode($_SESSION['latestpmscoverageresult']);
    $total = 0;
    foreach($data->entries as $entry) {
        if(date("d.m.Y", strtotime($entry->date)) == $_POST['data']['date']) {
            foreach($entry->roomsIncluded as $roomIncluded) {
                $booking = $this->getApi()->getPmsManager()->getBookingFromRoom($this->getSelectedMultilevelDomainName(), $roomIncluded);
                foreach($booking->rooms as $room) {
                    if($room->pmsBookingRoomId == $roomIncluded) {
                        echo "<tr>";
                        echo "<td valign='top'>";
                        echo $room->guests[0]->name . "<br>";
                        echo "</td>";
                        echo "<td valign='top'>";
                        $price = $entry->roomsPrice->{$room->pmsBookingRoomId};
                        echo round($price);
                        $total += $price;
                        echo "</td>";
                        echo "<td>";
                        if($room->bookingItemTypeId) {
                            $type = $this->getApi()->getBookingEngine()->getBookingItemType($this->getSelectedMultilevelDomainName(), $room->bookingItemTypeId)->name;
                            echo $type;
                        }
                        echo "</td>";
                        echo "<td>";
                        if($room->bookingItemId) {
                            $item = $this->getApi()->getBookingEngine()->getBookingItem($this->getSelectedMultilevelDomainName(), $room->bookingItemId);
                            echo $item->bookingItemName;
                        } else {
                            echo "floating";
                        }
                        echo "</td>";
                        
                        echo "</tr>";
                    }
                }
            }
       }
    }
    echo "<tr>";
    echo "<td></td>";
    echo "<td>".round($total)."</td>";
    echo "</tr>";
    ?>
</table>
