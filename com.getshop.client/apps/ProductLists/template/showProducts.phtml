<?
 /* @var $this ns_f245b8ae_f3ba_454e_beb4_ecff5ec328d6\ProductLists */

$columnSize = $this->getColumnSize();
$view = $this->isGridView() ? "grid_view" : "";
$view = $this->isRowView() ? "row_view" : $view;

?>
<div class="products <? echo $view; ?>"  listid="<? echo $this->getConfigurationSetting("productlist"); ?>">
    <?
    $products = $this->getAllProducts();
    if (!count($products)) {
        echo "<div class='no_products_added_to_list'><i class='fa fa-warning'></i> ".$this->__f("There is no products added to this list, manage your productlists from the settings.")."</div>";
        return;
    }
    foreach ($products as $product) {
        $linkName = \GetShopHelper::makeSeoUrl($product->name);
        $pageId = $product->pageId;
        $image = '<div class="image"><img src="/displayImage.php?id='.$product->imagesAdded[0].'&width=200"/></div>';
        ?>
            <div class='productbox_outer'>
                <div class='productbox'>
                <a ajaxlink='/?page=<? echo $pageId; ?>' href='<? echo $linkName;?>'>
                    <div class="product_row">
                        <?
                        if ($this->isRowView()) {
                            echo $image;
                        }
                        ?>
                        <div class="content">
                            <div class="product_title"><? echo $product->name; ?></div>
                            <?
                                if ($this->isGridView()) {
                                    echo $image;
                                }
                            ?>
                            <div class="short_description"><? echo nl2br($product->shortDescription); ?></div>
                        </div>
                    </div>
                </a>
                <div class="product_price" ><? echo $this->__f("Price")." ".$this->getCurrency().$product->price; ?></div>
                <div class="webshop_button addProductToCart" productId='<? echo $product->id; ?>'><? echo $this->__f("Add to cart"); ?></div>
                </div>
            </div>
        <?
    }
    ?>
</div>
<script>
    $(document).ready(function() {
        
        var innerWidth = $('.products.grid_view[listid="<? echo $this->getConfigurationSetting("productlist"); ?>"]').innerWidth();
        var columnSize = Math.floor(innerWidth/<? echo $columnSize; ?>);
        var totalSize = columnSize * <? echo $columnSize; ?>;
        if (totalSize == innerWidth) {
            columnSize--;    
        }
        if (innerWidth) {
            $('.productbox_outer').outerWidth(columnSize);
        }
    });
    
</script>
