<?
/* @var $this \ns_90d14853_2dd5_4f89_96c1_1fa15a39babd\SalesPointCartCheckout */
$originalCart = $this->getOriginalCartFromSession();
$currentCart = $this->getCurrentCart();
$total = $this->getApi()->getCartManager()->getCartTotal($currentCart);

$items = (array)$originalCart->items;
$i = 0;

if (!count($items)) {
    echo "Nothing to do";
    return;
}
$this->loadCartFilter();
echo "<div class='itemsarea'>";
foreach ($items as $item) {
    $i++;
    $lastItem = count($items) == $i ? "last_row" : "";
    $this->setCurrentItem($item);
    
    echo '<div class="cartitem row '.$lastItem.'" cartItemId="'.$item->cartItemId.'">';
    
    if ($item->addedByGetShopModule == "pms") {
        if (isset($item->priceMatrix) && $item->priceMatrix && count($item->priceMatrix)) {
            $this->includefile("pmswithmatrixitem");
        } else if(isset($item->itemsAdded) && $item->itemsAdded && count($item->itemsAdded)) {
            $this->includefile("pmsaddons");
        } else {
            $this->includefile("pmsnormalcartitem");
        }
    } 
    
    echo "</div>";
}
echo "</div>";
?>

<div class='summary'>
    <? echo $this->__f("Total"); ?>: <span><? echo $total; ?></span>
</div>

<?

if ($this->isReadOnly()) {
    return;
}


$paymentApps = $this->getApi()->getStoreApplicationPool()->getActivatedPaymentApplications();
?>

<div class="payment_options payment_window">
    <div class="option_content"></div>
    <div class="options">
        <select class='gsniceselect1 paymentmethodselection'>
            <option value="">Create a new order</option>
            <?
            //Need to find orders that has been created on the bookings and display them here!
            ?>
        </select>
    </div>
</div>

<div class="payment_options payment_window">
    <div class="option_content"></div>
    <div class="options">
        <?php
        $ecom = $this->getApi()->getStoreApplicationPool()->getApplication("9de54ce1-f7a0-4729-b128-b062dc70dcce");
        $ecomsettings = $this->getFactory()->getApplicationPool()->createInstace($ecom);
        ?>
        <select class='gsniceselect1 paymentmethodselection'>
            <?
            foreach ($paymentApps as $app) {
                $appInstance = $this->getFactory()->getApplicationPool()->createInstace($app);
                $selected = $ecomsettings->getConfigurationSetting("defaultPaymentMethod") == $app->id ? "SELECTED" : "";
                $name = $appInstance->getName();
                if($name == "InvoicePayment") {
                    $name = "Invoice";
                }
                
                echo "<option value='".$app->id."' $selected>" . $name . " ". "</option>";
            }
            ?>
        </select>
    </div>
</div>
<span class="shop_button continue_checkout">Continue</span>