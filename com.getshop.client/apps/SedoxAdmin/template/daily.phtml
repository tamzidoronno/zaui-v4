<?
/* @var $this ns_e22e25dd_8000_471c_89a3_6927d932165e\SedoxAdmin */
?>
<div class="title">
    Daily processing 
</div>
<div class="listview">
    <?
    $sedoxProducts = $this->getDayList();
    $pageId = $this->getPage()->id;
    if (count($sedoxProducts)) {
        echo "Number of files: ".count($sedoxProducts);
        echo "<hr>";
        foreach ($sedoxProducts as $sedoxProduct) {
            /* @var $sedoxProduct \core_sedox_SedoxProduct */
            $id = $sedoxProduct->id;
            $name = $sedoxProduct->brand . " " . $sedoxProduct->model . " " . $sedoxProduct->engineSize . " " . $sedoxProduct->power . " " . $sedoxProduct->year;
            $balance = $this->getCreditBalance($sedoxProduct);
            if ($balance > 0) {
                $balance = "<span style='color: green;'>$balance</span>";
            } else {
                $balance = "<span style='color: red;'>$balance</span>";
            }
            $userId = $sedoxProduct->firstUploadedByUserId;
            $impersonate = '<a href="/impersonate.php?userId='.$userId.'"><i class="fa fa-magic"></i></a>';
            $user = $this->getApi()->getUserManager()->getUserById($sedoxProduct->firstUploadedByUserId);
            $sedoxUser = $this->getApi()->getSedoxProductManager()->getSedoxUserAccountById($user->id);
            
            $indicateFixedPrice = $sedoxUser->fixedPrice ? "style='background-color: #FFFFE2'" : "";
            $isSlave = $sedoxUser->masterUserId ? true : false;
            $fullName = "<span class='showUserInformationSedox' userid='$userId'>".$user->fullName." ($balance) </span>";
            $date = $sedoxProduct->rowCreatedDate;
            $goto = "&nbsp;&nbsp;&nbsp;&nbsp;<a href='?page=productview&productId=$id'><i class='fa fa-arrow-right'></i></a>";
            $start = "Start";
            $starta = "Start";

            if ($sedoxProduct->started) {
                $starta = "Stop";
                $start = "Stop";
                $startedByUser = $this->getApi()->getUserManager()->getUserById($sedoxProduct->startedByUserId);
                if ($startedByUser != null) {
                    $time = $sedoxProduct->startedDate;
                    $start = "<span title=\"Started by $startedByUser->fullName<br/> Time: $time\">Stop</span>";
                }
            }
            $start = "<a class='$start' href='?page=$pageId&action=$starta&file=$id'>$start</a>";
            $status = "";
            
            if (array_key_exists("purchaseOnlyForCustomer", $sedoxProduct->states)) {
                $status = "<i style='color: red;' class='fa fa-usd'></i>";
            }
            
            if (array_key_exists("notifyForCustomer", $sedoxProduct->states)) {
                $status = "<i style='color: orange;' class='fa fa-comment'></i>";
            }
            
            if (array_key_exists("sendProductByMail", $sedoxProduct->states)) {
                $status = "<i style='color: green;' class='fa fa-check-circle'></i>";
            }
			
            $badCustomer = $this->isBadCustomer($sedoxProduct) ? "<i class='fa fa-warning' style='color: #CC0000;'></i> " : "";
            
            
            $slaveText = "";
            if ($isSlave) {
                $slaveText .= " | <i class='fa fa-user showUserInformationSedox' userid='".$sedoxUser->masterUserId."' style='color: #CC0000;'></i> ";
                $slaveText .= $sedoxUser->isPassiveSlave ? "(P)" : "(A)";
            }
            
            echo "
                    <div productId='$id' class='filelistrow' $indicateFixedPrice>
                        
                        <div class='col col1'> $impersonate &nbsp; $id </div>
                        <div class='col col2'> $name </div>
                        <div class='col col3'> $date </div>

                        <div class='col col4'> $badCustomer $fullName $slaveText</div>
                        <div class='col col5'> $start </div>
                        <div class='col col5'> $goto </div>
                        <div class='col col6'> &nbsp; $status </div>
                    </div>
                ";
            
            
        }
    } else {
        echo "Sorry! You dont have any files the specified day";
    }
    ?>
</div>
<div class='sedox_admin_topmenu bottom' menu="daylist">
    <div class='entry' changeto='0'> ToDay </div>
    <div class='entry' changeto='1'> 1 </div>
    <div class='entry' changeto='2'> 2 </div>
    <div class='entry' changeto='3'> 3 </div>
    <div class='entry' changeto='4'> 4 </div>
    <div class='entry' changeto='5'> 5 </div>
    <div class='entry' changeto='6'> 6 </div>
    <div class='entry' changeto='7'> 7 </div>
    <div class='entry' changeto='8'> 8 </div>
    <div class='entry' changeto='9'> 9 </div>
    <div class='entry' changeto='10'> 10 </div>
    <div class='entry' changeto='11'> 11 </div>
    <div class='entry' changeto='12'> 12 </div>
    <div class='entry' changeto='13'> 13 </div>
    <div class='entry' changeto='14'> 14 </div>
    <div class='entry' changeto='15'> 15 </div>
    <div class='entry' changeto='16'> 16 </div>
    <div class='entry' changeto='17'> 17 </div>
    <div class='entry' changeto='18'> 18 </div>
    <div class='entry' changeto='19'> 19 </div>
    <div class='entry' changeto='20'> 20 </div>
    <div class='entry' changeto='21'> 21 </div>
    <div class='entry' changeto='22'> 22 </div>
    <div class='entry' changeto='23'> 23 </div>
    <div class='entry' changeto='24'> 24 </div>
</div>