<?
$sedoxProduct = $this->getCurrentProduct();
$name = $sedoxProduct->brand . " " . $sedoxProduct->model . " " . $sedoxProduct->engineSize . " " . $sedoxProduct->power . " " . $sedoxProduct->year . " " . $sedoxProduct->originalChecksum;
$checksum = $sedoxProduct->originalChecksum ? $sedoxProduct->originalChecksum : "";
$reference = $this->getReference($sedoxProduct);
?>



<div class="productviewtoprow">
    <i class='fa fa-car'></i><div class="carname"><? echo $name; ?></div><div class="statictext">All files at this page are developed by Sedox Performance<br><font style="color: red; font-weight: bold;"> Download is not available unless you have credit at your account.</font></div>
</div>
<? if ($reference) { ?>
    <div class="referenceinfo">
        Reference: 
        <?
        echo $reference;
        ?>
    </div>
<? } ?>

<div class='sedox_product_box productinfo' style='position: relative;'>
    <div class='title'>Product Information</div>

    <div class='header'>
        <div class='col col1'>Created:</div>
        <div class='col col2'>Orig. Checksum:</div>
        <div class='col col3'>ECU Brand:</div>
        <div class='col col4'>ECU Type:</div>
        <div class='col col5'>ECU Part Nr.:</div>
        <div class='col col6'>ECU HW Nr.:</div>
        <div class='col col7'>ECU SW Nr.:</div>
        <div class='col col8'>Software Version:</div>
        <div class='col col9'>Size:</div>
        <div class='col col10'>Tool</div>
    </div>
    <div class='row'>
        <div class='col col1'><? echo $sedoxProduct->rowCreatedDate; ?></div>
        <div class='col col2'><? echo $sedoxProduct->originalChecksum; ?></div>
        <div class='col col3'><? echo $sedoxProduct->ecuBrand; ?></div>
        <div class='col col4'><? echo $sedoxProduct->ecuType; ?></div>
        <div class='col col5'><? echo $sedoxProduct->ecuPartNumber; ?></div>
        <div class='col col6'><? echo $sedoxProduct->ecuHardwareNumber; ?></div>
        <div class='col col7'><? echo $sedoxProduct->ecuSoftwareNumber; ?></div>
        <div class='col col8'><? echo $sedoxProduct->ecuSoftwareVersion; ?></div>
        <div class='col col9'><? echo $sedoxProduct->softwareSize; ?></div>
        <div class='col col10'><? echo $sedoxProduct->tool; ?></div>
    </div>
</div>


<div class='sedox_product_box downloadbox' style='position: relative;'>
    <div class='title'>Download</div>

    <div class='header'>
        <div class='col col1'>Type:</div>
        <div class='col col2'>Cost:</div>
        <div class='col col3'>Checksum updated:</div>
        <div class='col col4'>Extra information:</div>
        <div class='col col5'>Admin tools:</div>
    </div>
    <div class='row' >
        <?
        foreach ($sedoxProduct->binaryFiles as $binFile) {
            ?>
            <div class='binaryfilerow' binfileid="<? echo $binFile->id; ?>">
                <div class="col col1 squaredThree">
                    <input type="checkbox" value="None" id="squaredThree_<? echo $binFile->id; ?>" name="check" fileId="<? echo $binFile->id; ?>" />
                    <label for="squaredThree_<? echo $binFile->id; ?>"></label>
                    <? echo $binFile->fileType; ?>
                </div>

                <div class='col col2'><? echo strtolower($binFile->fileType) == "original" ? $this->getPriceForFile($binFile) : $this->getPriceForFile($binFile) + 40; ?></div>

                <div class='col col3'>
                    <?
                    if ($binFile->checksumCorrected == 0) {
                        echo "No";
                    } else if ($binFile->checksumCorrected == 1) {
                        echo "Yes";
                    } else {
                        echo "N/A";
                    }
                    ?>
                </div>
                <div class='col col4'>
                    <? echo $binFile->extraInformation; ?>
                </div>
                <? if ($this->hasWriteAccess()) { ?>
                    <div class='col col5'>
                        <i productid="<? echo $sedoxProduct->id; ?>" class="fa fa-trash-o deletebinfile"></i>
                        <i productid="<? echo $sedoxProduct->id; ?>" fileid="<? echo $binFile->id; ?>" class="fa fa-info-circle changeinfo"></i>
                    </div>
                <? } ?>
            </div>
            <?
        }
        ?> 
    </div>
    <? if ($this->hasWriteAccess()) { ?>
        <div style='position: absolute; top: 0px; right: 0px;'class="add_tuningfile">
            <div>
                <div fileType='Tune' class='uploadtuningfilebox fa fa-upload'><div style='font-size: 11px;'>Tune</div><div class='progressbar'></div></div>
                <div fileType='ECO' class='uploadtuningfilebox fa fa-upload'><div style='font-size: 11px;'>ECO</div><div class='progressbar'></div></div>
                <div fileType='Power' class='uploadtuningfilebox fa fa-upload'><div style='font-size: 11px;'>Power</div><div class='progressbar'></div></div>
                <div fileType='Various' class='uploadtuningfilebox fa fa-upload'><div style='font-size: 11px;'>Various</div><div class='progressbar'></div></div>
                <div fileType='Original' class='uploadtuningfilebox fa fa-upload'><div style='font-size: 11px;'>Original</div><div class='progressbar'></div></div>
                <div fileType='Cmd Original' class='uploadtuningfilebox fa fa-upload'><div style='font-size: 11px;'>CMD Original</div><div class='progressbar'></div></div>
            </div>
        </div>
    <? } ?>
    <div class='row'>
        <div class='sedox_button purchase'>Purchase and download</div>
        <div class='sedox_warning'>Note! When you click on the button below you will download the file and it will be purchased. </div>
    </div>
</div>

<?
if (!$this->hasWriteAccess()) {
    return;
}

$sedoxUser = $this->getUploadedSedoxUser($sedoxProduct);
$uploadedByUser = $this->getUploadedUserName($sedoxProduct);
$slaveWarning = $sedoxUser->masterUserId ? "<div  title='This is a slave' class='slavewarning showUserInformationSedox' userid='".$sedoxUser->masterUserId."'><i class='fa fa-warning'></i><br/>Slave</div>" : "";
?>
<div class='admintools'>
    <div class='startedbyinfo'>
        <?
        if ($sedoxProduct->started) {
            $startedByUser = $this->getApi()->getUserManager()->getUserById($sedoxProduct->startedByUserId);
            if ($startedByUser != null) {
                $time = $sedoxProduct->startedDate;
                echo "Started by $startedByUser->fullName<br/> Time: $time";
            }
        } else {
            echo "Not started yet";
        }
        ?>
    </div>
    <div class='userinfo'>
        <div class='subcontainer' style="margin-bottom: 0px; padding: 5px; ">
            <? echo $uploadedByUser->fullName . " (id: $uploadedByUser->id) (Credit: " . $sedoxUser->creditAccount->balance . ")"; ?>
            <br> Email: <? echo $uploadedByUser->emailAddress; ?>
        </div>
    </div>

    <div class='title'><i class='fa fa-lightbulb-o'></i>&nbsp; Purchase file for customer.</div>
    <div class='subcontainer'>
        <div class="box122">
            <textarea class="infotextareatocustomer" placeholder="Information to attach to the mail."></textarea>
            <br><input type="textfield" class="original_check_input_box" placeholder="Insert original checksum here" value="<? echo $checksum; ?>"/>
        </div>

        <div class="box122 additional_info">
            <?
            echo $slaveWarning;
            ?>
            <b>User comment: </b>
            <br><? echo $sedoxProduct->comment; ?>
            <br>
            <br><b>Uploaded from: </b>
            <br><? echo $sedoxProduct->uploadOrigin; ?>
            <br>
            <br><b>Automatic gear: </b> 

            <?
            if ($sedoxProduct->gearType == "auto") {
                echo "<span style='color:green'>Yes</span>";
            } else {
                echo "<span style='color:red'>No</span>";
            }
            ?>

            <br>
            <br><b>Withdraw credit:</b> <?
            if ($sedoxProduct->useCreditAccount == "true") {
                echo "<span style='color:green'>Yes</span>";
            } else {
                echo "<span style='color:red'>No</span>";
            }
            ?>
        </div>
        <br>
        <br>
<?
$class1 = array_key_exists("purchaseOnlyForCustomer", $sedoxProduct->states) ? "active" : "";
$class2 = array_key_exists("notifyForCustomer", $sedoxProduct->states) ? "active" : "";
$class3 = array_key_exists("sendProductByMail", $sedoxProduct->states) ? "active" : "";
$class4 = $sedoxProduct->saleAble ? "saleable" : "";
$text = $sedoxProduct->saleAble ? "Make product NOT salable" : "Make product saleable";
$badCustomer = $sedoxUser->badCustomer == "true" ? "<div><i class='fa fa-warning' style='color: #CC0000;'></i> <b>THIS IS A BAD CUSTOMER!</b></div> <br/>" : "";

if ($sedoxProduct->started) {
    $startedByUser = $this->getApi()->getUserManager()->getUserById($sedoxProduct->startedByUserId);
    if ($startedByUser != null && \ns_df435931_9364_4b6a_b4b2_951c90cc0d70\Login::getUserObject()->id != $startedByUser->id) {
        echo "<div class='started_warning_not_you'> <i class='fa fa-warning'></i> This product is started, but not by you! Maybe someone else is working on this?</div>";
    }
}
echo $badCustomer;
?>
        <div class="adminbottons">
            <div productid="<? echo $sedoxProduct->id; ?>" class="sedox_button savechecksumonly">Save checksum only</div>
            <div productid="<? echo $sedoxProduct->id; ?>" class="sedox_button purchaseorderonly <? echo $class1; ?>">Purchase order only</div>
            <div productid="<? echo $sedoxProduct->id; ?>" class="sedox_button notifybyemailandsms <? echo $class2; ?>">Notify by email and sms</div>
            <div productid="<? echo $sedoxProduct->id; ?>" class="sedox_button sendproductbyemail <? echo $class3; ?>">Send product by email</div>
            <div productid="<? echo $sedoxProduct->id; ?>" class="sedox_button togglesalable <? echo $class4; ?>"><? echo $text; ?></div>
        </div>

    </div>

    <div class='sedox_product_box product_history' style='position: relative;'>
        <div class='title'>History</div>

<?
if (count($sedoxProduct->histories) == 0) {
    echo "<div class='row'><div class='col'>There is no history for this product</div></div>";
} else {
    ?>
            <div class='header'>
                <div class='col col1'>Date:</div>
                <div class='col col2'>Comment:</div>
                <div class='col col3'>By user:</div>
            </div>
    <?
    foreach ($sedoxProduct->histories as $hist) {
        $date = $hist->dateCreated;
        $desc = $hist->description;
        $user = $this->getApi()->getUserManager()->getUserById($hist->userId)->fullName;
        echo "<div class='row'><div class='col col1'>$date</div><div class='col col2'>$desc</div><div class='col col3'>$user</div></div>";
    }
}
?>
    </div>
</div>