package com.thundashop.api.managers;

import com.google.gson.GsonBuilder;
import com.google.gson.Gson;
import com.google.gson.reflect.TypeToken;
import java.lang.reflect.Type;
import java.util.HashMap;
import java.util.LinkedHashMap;
import com.thundashop.core.common.JsonObject2;
import com.thundashop.core.cartmanager.data.Coupon;
import com.thundashop.core.usermanager.data.Address;
import java.util.List;
import com.thundashop.core.cartmanager.data.Cart;

public class APICartManager {

      public Transporter transport;

      public APICartManager(Transporter transport){
           this.transport = transport;
      }

     /**
     * Add coupons to the system.
     */

     public void addCoupon(Coupon coupon)  throws Exception  {
          JsonObject2 data = new JsonObject2();
          data.args = new LinkedHashMap();
          data.args.put("coupon",new Gson().toJson(coupon));
          data.method = "addCoupon";
          data.interfaceName = "core.cartmanager.ICartManager";
          String result = transport.send(data);
     }

     /**
     * Add a new product to the cart.
     * @param productId The product id generated by the productmanager.
     * @param int Number instances of the product ordered.
     * @return Cart
     * @throws ErrorException 
     */

     public Cart addProduct(String productId, int count, List<String> variations)  throws Exception  {
          JsonObject2 data = new JsonObject2();
          data.args = new LinkedHashMap();
          data.args.put("productId",new Gson().toJson(productId));
          data.args.put("count",new Gson().toJson(count));
          data.args.put("variations",new Gson().toJson(variations));
          data.method = "addProduct";
          data.interfaceName = "core.cartmanager.ICartManager";
          String result = transport.send(data);
          Gson gson = new GsonBuilder().serializeNulls().create();
          Type typeJson_3323322222_autogenerated = new TypeToken<Cart>() {}.getType();
          Cart object = gson.fromJson(result, typeJson_3323322222_autogenerated);
          return object;
     }

     /**
     * Apply the coupon to the cart.
     */

     public void applyCouponToCurrentCart(String code)  throws Exception  {
          JsonObject2 data = new JsonObject2();
          data.args = new LinkedHashMap();
          data.args.put("code",new Gson().toJson(code));
          data.method = "applyCouponToCurrentCart";
          data.interfaceName = "core.cartmanager.ICartManager";
          String result = transport.send(data);
     }

     /**
     * Send in a cart and you shall have the total price for all products.
     */

     public Double calculateTotalCost(Cart cart)  throws Exception  {
          JsonObject2 data = new JsonObject2();
          data.args = new LinkedHashMap();
          data.args.put("cart",new Gson().toJson(cart));
          data.method = "calculateTotalCost";
          data.interfaceName = "core.cartmanager.ICartManager";
          String result = transport.send(data);
          Gson gson = new GsonBuilder().serializeNulls().create();
          Type typeJson_3323322222_autogenerated = new TypeToken<Double>() {}.getType();
          Double object = gson.fromJson(result, typeJson_3323322222_autogenerated);
          return object;
     }

     /**
     * Clear the current shopping cart.
     */

     public void clear()  throws Exception  {
          JsonObject2 data = new JsonObject2();
          data.args = new LinkedHashMap();
          data.method = "clear";
          data.interfaceName = "core.cartmanager.ICartManager";
          String result = transport.send(data);
     }

     /**
     * Fetch the current cart.
     * @return Cart
     * @throws ErrorException 
     */

     public Cart getCart()  throws Exception  {
          JsonObject2 data = new JsonObject2();
          data.args = new LinkedHashMap();
          data.method = "getCart";
          data.interfaceName = "core.cartmanager.ICartManager";
          String result = transport.send(data);
          Gson gson = new GsonBuilder().serializeNulls().create();
          Type typeJson_3323322222_autogenerated = new TypeToken<Cart>() {}.getType();
          Cart object = gson.fromJson(result, typeJson_3323322222_autogenerated);
          return object;
     }

     /**
     * Returns the current total amount
     * note, this does not include shipping.
     * 
     * @return Double
     * @throws ErrorException 
     */

     public Double getCartTotalAmount()  throws Exception  {
          JsonObject2 data = new JsonObject2();
          data.args = new LinkedHashMap();
          data.method = "getCartTotalAmount";
          data.interfaceName = "core.cartmanager.ICartManager";
          String result = transport.send(data);
          Gson gson = new GsonBuilder().serializeNulls().create();
          Type typeJson_3323322222_autogenerated = new TypeToken<Double>() {}.getType();
          Double object = gson.fromJson(result, typeJson_3323322222_autogenerated);
          return object;
     }

     /**
     * Returns a list of all coupons.
     * @return List<Coupon>
     */

     public List<Coupon> getCoupons()  throws Exception  {
          JsonObject2 data = new JsonObject2();
          data.args = new LinkedHashMap();
          data.method = "getCoupons";
          data.interfaceName = "core.cartmanager.ICartManager";
          String result = transport.send(data);
          Gson gson = new GsonBuilder().serializeNulls().create();
          Type typeJson_3323322222_autogenerated = new TypeToken<List<Coupon>>() {}.getType();
          List<Coupon> object = gson.fromJson(result, typeJson_3323322222_autogenerated);
          return object;
     }

     /**
     * Returns the shipping cost
     * @return Double
     */

     public Double getShippingCost()  throws Exception  {
          JsonObject2 data = new JsonObject2();
          data.args = new LinkedHashMap();
          data.method = "getShippingCost";
          data.interfaceName = "core.cartmanager.ICartManager";
          String result = transport.send(data);
          Gson gson = new GsonBuilder().serializeNulls().create();
          Type typeJson_3323322222_autogenerated = new TypeToken<Double>() {}.getType();
          Double object = gson.fromJson(result, typeJson_3323322222_autogenerated);
          return object;
     }

     /**
     * Fetch the total amount of price to use when calculating shipping price.
     * @return Double
     * @throws ErrorException 
     */

     public Double getShippingPriceBasis()  throws Exception  {
          JsonObject2 data = new JsonObject2();
          data.args = new LinkedHashMap();
          data.method = "getShippingPriceBasis";
          data.interfaceName = "core.cartmanager.ICartManager";
          String result = transport.send(data);
          Gson gson = new GsonBuilder().serializeNulls().create();
          Type typeJson_3323322222_autogenerated = new TypeToken<Double>() {}.getType();
          Double object = gson.fromJson(result, typeJson_3323322222_autogenerated);
          return object;
     }

     /**
     * Remove all coupons from the system.
     * @throws ErrorException 
     */

     public void removeAllCoupons()  throws Exception  {
          JsonObject2 data = new JsonObject2();
          data.args = new LinkedHashMap();
          data.method = "removeAllCoupons";
          data.interfaceName = "core.cartmanager.ICartManager";
          String result = transport.send(data);
     }

     /**
     * Remove a coupon from the system.
     * 
     * @param coupon
     * @throws ErrorException 
     */

     public void removeCoupon(String code)  throws Exception  {
          JsonObject2 data = new JsonObject2();
          data.args = new LinkedHashMap();
          data.args.put("code",new Gson().toJson(code));
          data.method = "removeCoupon";
          data.interfaceName = "core.cartmanager.ICartManager";
          String result = transport.send(data);
     }

     /**
     * Remove an added product from the cart.
     * @param productId The product id generated by the productmanager, that has been added to the cart.
     * @return Cart
     * @throws ErrorException 
     */

     public Cart removeProduct(String cartItemId)  throws Exception  {
          JsonObject2 data = new JsonObject2();
          data.args = new LinkedHashMap();
          data.args.put("cartItemId",new Gson().toJson(cartItemId));
          data.method = "removeProduct";
          data.interfaceName = "core.cartmanager.ICartManager";
          String result = transport.send(data);
          Gson gson = new GsonBuilder().serializeNulls().create();
          Type typeJson_3323322222_autogenerated = new TypeToken<Cart>() {}.getType();
          Cart object = gson.fromJson(result, typeJson_3323322222_autogenerated);
          return object;
     }

     /**
     * Set a new address to the current cart.
     */

     public void setAddress(Address address)  throws Exception  {
          JsonObject2 data = new JsonObject2();
          data.args = new LinkedHashMap();
          data.args.put("address",new Gson().toJson(address));
          data.method = "setAddress";
          data.interfaceName = "core.cartmanager.ICartManager";
          String result = transport.send(data);
     }

     /**
     * Sets the shipping cost.
     * Should be in base currency.
     */

     public void setShippingCost(double shippingCost)  throws Exception  {
          JsonObject2 data = new JsonObject2();
          data.args = new LinkedHashMap();
          data.args.put("shippingCost",new Gson().toJson(shippingCost));
          data.method = "setShippingCost";
          data.interfaceName = "core.cartmanager.ICartManager";
          String result = transport.send(data);
     }

     /**
     * Change the number of instances added to the product.
     * @param productId The product id generated by the productmanager.
     * @param count The number of instances (has to be a positive integer)
     * @return Cart
     * @throws ErrorException 
     */

     public Cart updateProductCount(String cartItemId, int count)  throws Exception  {
          JsonObject2 data = new JsonObject2();
          data.args = new LinkedHashMap();
          data.args.put("cartItemId",new Gson().toJson(cartItemId));
          data.args.put("count",new Gson().toJson(count));
          data.method = "updateProductCount";
          data.interfaceName = "core.cartmanager.ICartManager";
          String result = transport.send(data);
          Gson gson = new GsonBuilder().serializeNulls().create();
          Type typeJson_3323322222_autogenerated = new TypeToken<Cart>() {}.getType();
          Cart object = gson.fromJson(result, typeJson_3323322222_autogenerated);
          return object;
     }

}
